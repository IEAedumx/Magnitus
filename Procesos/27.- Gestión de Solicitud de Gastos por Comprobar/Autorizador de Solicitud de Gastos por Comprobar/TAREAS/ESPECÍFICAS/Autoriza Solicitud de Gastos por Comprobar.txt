<tarea id="ASGXC" nombre="Autoriza Solicitud de Gastos por Comprobar">
    <pagina id="1" nombre="Autoriza Solicitud de Gastos por Comprobar">
         <!-- CURSORES -->
            <nivel id="per" nombre="per" interactivo="false">
                <componente tipo="cursor" id="per" nombre="per">
                  <tabla schema="catalog" nombre="periodo">
                    <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$config.ur$"/>
                    <campo name="id_periodo"/>
                    <campo name="estatus" filtroCampo="estatus" filtroOperador="=" filtroValor="true"/>
                    <campo name="id_estatus" filtroCampo="id_estatus" filtroOperador="=" filtroValor="3"/>
                    <campo name="id_separador" /> 
                  </tabla>
                </componente>
            </nivel>
            
            
            <nivel id="barreUsuarios" nombre="barreUsuarios" interactivo="false">
                <componente id="barreUsuarios" nombre="barreUsuarios" tipo="cursor">
                    <tabla schema="entity" nombre="usuario">
                        <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$config.ur$"/>
                        <campo name="id_usuario"/>
                        <campo name="nombre_usuario" filtroCampo="nombre_usuario" filtroOperador="=" filtroValor="$protocolarios.user$"/>
                        <campo name="nombre"/>
                        <campo name="primer_apellido"/>
                        <campo name="segundo_apellido"/>
                        <campo name="permisos_especiales"/>
                        <campo name="id_cat_centro_registro"/>
                        <campo name="id_centro_registro"/>
                        <campo name="permisos_especiales"/>
                    </tabla>
                </componente>
            </nivel>    
            
            <nivel id="obSeparador" nombre="obSeparador" interactivo="false">
          <componente tipo="cursor" id="obSeparador" nombre="obSeparador">
            <tabla schema="catalog" nombre="separador">
              <campo name="id_separador" filtroCampo="id_separador" filtroOperador="=" filtroValor="%per.per.id_separador%"/>
              <campo name="caracter"/>
            </tabla>
          </componente>
        </nivel>
        <!-- FIN CURSORES -->
        
            <!-- Maestro Detalle-->
        <nivel id="RSGC3" nombre="Registra Solicitud de Gastos por Comprobar" mostrarNivelAnterior="false" mostrarProximoNivel="false">
            <componente nombre="Registra Gastos por Comprobar" tipo="maestroDetalle" id="RSGC3" mostrarEliminar="false" mostrarEditar="false" mostrarAgregar="false">
                <encabezado accionDefault="editar"> 
                    <tabla id="tablaEncabezadoDUEP" schema="operation" nombre="duep">
                        <campo name="ur" text="Unidad Responsable" visible="false" llaveForanea="false" calc="$inParam.ur$"/>
                        <campo name="periodo" text="Periodo" visible="false" calc="$inParam.periodo$" llaveForanea="false"/> 
                        <campo name="folio_duep" text="Folio" visible="true" calc="$inParam.folio_duep$" columnas="3" />
                        
                        <campo name="tramite" text="Trámite" marcador="Trámite" descripcionForanea="siglas,nombre" columnas="3" habilitado="false"/>
                        <campo name="funcionario_solicitante" text="Funcionario Solicitante" descripcionForanea="nombre,primer_apellido,segundo_apellido" marcador="Seleccionar un Proveedor" validacion="%funcionario_solicitante%==null" validacionMensaje="Favor de seleccionar un Beneficiario" columnas="3"  habilitado="false"/>
                        <campo name="id_cat_fondo_contable" text="Categoría de Fondo Contable" llaveForanea="false" visible="false"/>
                        <campo name="id_fondo_contable" text="Fondo Contable" marcador="Seleccione un Fondo Contable" validacion="%id_fondo_contable%==null" validacionMensaje="Favor de seleccionar un fondo contable para continuar" columnas="3"  habilitado="false"/>
                        <campo name="id_cat_unidad_ejecutora_gasto" text="Categoría Unidad Ejecutora" visible="false" llaveForanea="false" calc="2"/>
                        <campo name="id_unidad_ejecutora_gasto" text="Unidad Ejecutora" marcador="Selecciona una Unidad Ejecutora" validacion="%id_unidad_ejecutora_gasto%==null" validacionMensaje="Favor de seleccionar una Unidad Ejecutora" columnas="3"  habilitado="false"/>
                       <campo name="id_fuente_financiamiento" text="Fuente de Financiamiento" llaveForanea="false" calc="5" habilitado="false" visible="false"/>
                        <campo name="id_cat_fuente_financiamiento" text="Fuente de Financiamiento *" columnas="3" habilitado="false" descripcionForanea="id_cat,descripcion" autoFiltrado="true" maxlenght="50" autoFiltradoDescripcion="id_cat,descripcion"/>
                        <campo name="fecha_solicitud" text="Fecha de Solicitud" habilitado="%barreUsuarios.barreUsuarios.permisos_especiales%==true" columnas="3" />
                        <campo name="fecha_autorizacion" text="Fecha de Autorización" habilitado="false" marcador="Fecha de Autorización" visible="false" columnas="3" margen-derecho="2"/>
                        <campo name="concepto" text="Concepto" height="100" columnas="6" margen-izquierdo="2" habilitado="false"/>
                        <campo name="ultimo_usuario_modificador" visible="false"/>
                        <campo name="estatus_duep" text="Estatus" visible="false" llaveForanea="false" calc="6"/>
                    </tabla>
                    <estilos>
                        <boton nombre="grabar" texto="CONTINUAR" margen-izquierdo="4" columnas="2" margen-derecho="4" visible="false"/>
                    </estilos>
                </encabezado>
                <detalles>
                    <tabla id="detalle_bloques" schema="operation" nombre="duep_detalle" tituloDetalle="Renglones" mostrarEditar="false" mostrarAgregar="false" mostrarEliminar="false" >
                        <campo name="ur" text="Unidad Responsable" llaveForanea="false" visible="false" columna-visible="false"/>
                        <campo name="periodo" text="Periodo" llaveForanea="false" visible="false" columna-visible="false"/>
                        <campo name="folio_duep" text="Folio" llaveForanea="false" visible="false" columna-visible="false"/>
                        <campo name="folio_duep_detalle" text="Renglón" generacion="@prox()+1" autogenerado="true" width="100" columnas="3" margen-izquierdo="2"/>
                        <campo name="tipo_detalle" text="Tipo de Renglón" validacion="%tipo_detalle%==null" validacionMensaje="Debe de Capturar el Tipo de Renglón" width="100" columnas="3" margen-derecho="2" habilitado="false"/>
                       
                       
                        <campo name="articulo" text="Artículo" habilitado="false"  descripcionForanea="descripcion_articulo" descripcionForaneaTabla="descripcion_articulo" marcador="Seleccione un artículo" width="100" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-izquierdo="2"/> 
                        <campo name="id_cat_objeto_gasto" text="Cat Objeto del Gasto" visible="false" columna-visible="false" llaveForanea="false"/>
                        <campo name="c_objeto_gasto" text="Objeto del Gasto" visible="true" width="150" columnas="3" margen-izquierdo="2"/>
                        
                        <campo name="descripcion_especifica"  text="Descripción Específica" width="200" mascara="C" validacion="%descripcion_especifica%==null" validacionMensaje="Descripción Específica es requerido" columnas="3" margen-derecho="2"/>
                        <campo name="id_cat_programa_presupuestal" text="Programa Presupuestal" llaveForanea="false" visible="false" columna-visible="false"/>
                        <campo name="programa_presupuestal" text="Programa Presupuestal" marcador="Seleccione un programa presupuestal" width="150" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-derecho="2" autoFiltrado="true" maxlenght="50" autoFiltradoDescripcion="id_cat,descripcion"/>
                        
                        <campo name="folio_comprobante" text="Folio Comprobante" columna-visible="false" habilitado="false" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-derecho="2"/>
                        <campo name="tipo_comprobante" text="Tipo de Comprobante" columna-visible="false" interaccion-visible="%tipo_detalle%==2 OR %tipo_detalle%==1" columnas="3" habilitado="false"/>
                        <campo name="cantidad" text="Cantidad" validacion="%tipo_detalle%==1 AND %cantidad%==null" validacionMensaje="Favor de Capturar la Cantidad" width="100" columnas="3" margen-izquierdo="2" interaccion-visible="%tipo_detalle%==1" habilitado="false"/>
                        <campo name="u_medida" text="U.M." validacion="%tipo_detalle%==1 AND %u_medida%==null" validacionMensaje="Capture la Unidad de Medida" width="100" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-derecho="2" habilitado="false"/>
                        <campo name="precio_unitario" text="Importe Unitario" validacion="%tipo_detalle%==1 AND %precio_unitario%==null" validacionMensaje="Debe de Capturar el Precio Unitario" width="100" interaccion-visible="%tipo_detalle%==1" columnas="3" habilitado="false"/>

                        <campo name="mes_cve_presupuestal" text="Mes" visible="false" columna-visible="false" llaveForanea="false"/>
                        <campo name="clave_presupuestal" text="clave presupuestal" columna-visible="false" habilitado="false" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-derecho="2" llaveForanea="false" calcCliente="@ifThenElse(%tipo_detalle%==1,@concatenar(@ifThenElse(%consultaInformacion.generaSEDS.id_unidad_ejecutora_gasto%==null,'',%consultaInformacion.generaSEDS.id_unidad_ejecutora_gasto%)+' '+@ifThenElse(%consultaInformacion.generaSEDS.id_fondo_contable%==null,'',%consultaInformacion.generaSEDS.id_fondo_contable%)+' '+@ifThenElse(%c_objeto_gasto%==null,'',%c_objeto_gasto%)+' '+@ifThenElse(%consultaInformacion.generaSEDS.id_cat_fuente_financiamiento%==null,'',%consultaInformacion.generaSEDS.id_cat_fuente_financiamiento%)+' '+@ifThenElse(%programa_presupuestal%==null,'',%programa_presupuestal%)),null)"/> 
                        <campo name="importe" text="Total" habilitado="false" muestraAcumulado="true" columnas="3" margen-izquierdo="2"/>
                      </tabla>
                            <acciones>
                        <accion nombre="grabar" visible="true" hacer="saltar siguiente nivel"/>
                    </acciones>
                    
                    <estilos>
                        <boton nombre="grabar"  visible="true" texto="CONTINUAR" />
                        <boton nombre="formulario"  visible="true" texto="CONTINUAR" />
                    </estilos>
            
                </detalles>
            </componente>
        </nivel> 
            
        <!-- Fin de Maestro-->
                
          <!-- REPORTE --> 
        <nivel id="RSGC5" nombre="Registra Solicitud de Gastos por Comprobar" mostrarNivelAnterior="false" mostrarProximoNivel="false"> 
            <componente tipo="reporte" nombre="Documento Unico del Ejercicio del Presupuesto" id="registraReporte">
                <reporte nombre="doc_presupuesto_GGPC">
                    <campo name="ur" type="long" calc="$inParam.ur$"/>
                    <campo name="periodo"  type="long" calc="$inParam.periodo$"/>
                    <campo name="usuario" type="string" calc="@castTo($protocolarios.user$,'string')"/>
                    <campo name="folio_duep" type="long" calc="$inParam.folio_duep$"/>
                </reporte>
            </componente>
         
            <componente id="form_ASGXC" nombre="Autoriza Solicitud de Gastos por Comprobar " tipo="formulario" accionDefault="seleccionar">
                <tabla schema="operation" nombre="duep">
                    <campo name="ur" habilitado="false" calc="$inParam.ur$" llaveForanea="false" visible="false" text="Unidad Responsable"/>
                    <campo name="periodo" habilitado="false" calc="$inParam.periodo$" visible="false" text="Periodo"/>
                    <campo name="folio_duep" habilitado="false" calc="$inParam.folio_duep$" visible="false" text="Folio Duep"/> 
                    <campo name="id_cat_fondo_contable" visible="false" llaveForanea="false"/>
                    <campo name="id_fondo_contable" visible="false" llaveForanea="false"/>
                    <campo name="funcionario_solicitante" visible="false" llaveForanea="false"/>
                    <campo name="autoriza_gasto_comprobar" text="Autoriza" margen-izquierdo="4" columnas="3"/>
                    <campo name="motivo_rechazo_autoriza" text="Motivo de Rechazo" margen-derecho="3" margen-izquierdo="3" width="100" height="100" columnas="4" interaccion="%autoriza_gasto_comprobar%==false" validacion="%motivo_rechazo_autoriza%==null AND %autoriza_gasto_comprobar%==false" validacionMensaje="Falta motivo de rechazo" mascara="C"/>
                </tabla>
                    <acciones>
                        <accion nombre="grabar" visible="true" hacer="saltar siguiente nivel" /> 
                    </acciones>
                    <estilos>
                        <boton nombre="grabar"  visible="true" texto="Continuar" columnas="2" margen-izquierdo="8"/>
                    </estilos>
            </componente>
        </nivel>
        
        <nivel id="cambiaEstatus" nombre="cambiaEstatus" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
            <componente tipo="cursor" id="cambiaEstatus" nombre="cambiaEstatus">
                <tabla schema="operation" nombre="duep">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="$inParam.ur$" />
                    <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="$inParam.periodo$"/>
                    <campo name="folio_duep" filtroCampo="folio_duep" filtroOperador="=" filtroValor="$inParam.folio_duep$" /> 
                    <campo name="estatus_duep" calc="4"/>
                </tabla>
            </componente>
        </nivel>
        <!--FIN INSTANCIA FALSO-->
        
         <!-- Genera poliza -->
         
             <nivel id="barrePresupuestoEgresos" nombre="barrePresupuestoEgresos" interactivo="false">
        <componente id="barrePresupuestoEgresos" nombre="barrePresupuestoEgresos" tipo="cursor">
            <tabla schema="operation" nombre="presupuesto_egresos">
                <campo name="id_unidad_responsable"  filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$inParam.ur$" />
                <campo name="id_periodo" filtroCampo="id_periodo" filtroOperador="=" filtroValor="$inParam.periodo$" />
                
                <campo name="id_presupuesto_egresos" llaveForanea="false"/>
                <campo name="fecha_elaboracion"/>
                <campo name="estatus"/>
                <campo name="observaciones"/> 
                <campo name="ultimo_usuario_modificador"/> 
                <campo name="observaciones_valida"/>
                <campo name="validacion"/>
                <campo name="total"/>
            </tabla>
         </componente> 
        </nivel> 
         
     
     
     <!-- TABLA -->
        <!--<nivel id="ASGXC_nivelDos" nombre="Autoriza Solicitud de Gasos por Comprobar" mostrarProximoNivel="true" mostrarNivelAnterior="false">
            <componente id="DDP" nombre="Detalle de Disponibles Presupuestales" tipo="tabla" mostrarEditar="false" mostrarEliminar="false" mostrarAgregar="false">
                <tabla schema="operation" nombre="duep_detalle" accionDefault="editar">
                    <campo name="ur" text="Unidad Responsable" llaveForanea="false" calc="$inParam.ur$" visible="true" columna-visible="false"/>
                    <campo name="periodo" text="Periodo" llaveForanea="false" visible="true" calc="$inParam.periodo$" columna-visible="false"/>
                    <campo name="folio_duep" text="Folio DUEP" llaveForanea="false" visible="true" calc="$inParam.folio_duep$" columna-visible="false"/>
                    
                    <campo name="folio_duep_detalle" text="Identificador de la Clave" columnas="3" margen-izquierdo="2"/> 
                    <campo name="clave_presupuestal" text="Clave Presupuestal" columna-visible="true" habilitado="false" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-derecho="2" llaveForanea="false" calcCliente="@ifThenElse(%tipo_detalle%==1,@concatenar(@ifThenElse(%consultaInformacion.generaSEDS.id_unidad_ejecutora_gasto%==null,'',%consultaInformacion.generaSEDS.id_unidad_ejecutora_gasto%)+' '+@ifThenElse(%consultaInformacion.generaSEDS.id_fondo_contable%==null,'',%consultaInformacion.generaSEDS.id_fondo_contable%)+' '+@ifThenElse(%c_objeto_gasto%==null,'',%c_objeto_gasto%)+' '+@ifThenElse(%consultaInformacion.generaSEDS.id_cat_fuente_financiamiento%==null,'',%consultaInformacion.generaSEDS.id_cat_fuente_financiamiento%)+' '+@ifThenElse(%programa_presupuestal%==null,'',%programa_presupuestal%)),null)"/> 
                    <campo name="importe" text="Aplicacion Presupuestal" columnas="3" margen-izquierdo="2" formatoMoneda="true" habilitado="false" muestraAcumulado="true"/>
                    <campo name="total" text="Disponible Actual" calc="%barrePresupuestoEgresos.barrePresupuestoEgresos.total%"  columnas="3" margen-izquierdo="2" habilitado="false"/>
                    
                    <campo name="importe_requerido" text="Disponible Requerido" local="true" type="long" columnas="3" calcCliente="(@ifThenElse(%total%==null,0,%total%) - @ifThenElse(%importe%==null,0,%importe%))"  margen-izquierdo="2" habilitado="false"/>
                </tabla>
            </componente>
        </nivel> -->
        
  
        
      <!-- ENCABEZADO DE LA PÓLIZA -->
        <nivel id="nlGenEncabezadoPolizaCom" nombre="Generación del Encabezado de la Póliza" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
            <componente id="cpGenEncabezadoPolizaCom" nombre="Generación del Encabezado de la Póliza" tipo="altaDirect">
                <tabla schema="operation" nombre="movimientos_auxiliares">
                   <campo name="ur" calc="%RSGC5.form_ASGXC.ur%"/> 
                   <campo name="periodo" calc="%RSGC5.form_ASGXC.periodo%"/>
                   <campo name="folio_movimiento_auxiliar" generacion="@prox()+1" autogenerado="true"/>
                   <campo name="fecha_poliza" calc="@fechaSistema()"/>
                   <campo name="tipo_poliza" calc="1"/>
                   <campo name="momento_contable" calc="4"/>
                   <campo name="estatus_poliza" calc="2"/>
                   <campo name="id_catalogo" calc="%RSGC5.form_ASGXC.id_cat_fondo_contable%"/>
                   <campo name="fondo_contable" calc="%RSGC5.form_ASGXC.id_fondo_contable%"/>
                   <campo name="funcionario" calc="%RSGC5.form_ASGXC.funcionario_solicitante%"/>
                   <campo name="folio_reporte" calc="%RSGC5.form_ASGXC.folio_duep%"/> 
                   <campo name="origen_poliza" calc="1"/>
                   <campo name="concepto_general" calc="@concatenar('Póliza del Presupuesto de Egresos Comprometidos de la Solicitud de Gastos por Comprobar'+$inParam.folio_duep$)" />
                </tabla>
            </componente>
        </nivel>
        <nivel id="nlBarridoDetalleDUEPCom" nombre="Barrido de los Detalles del DUEP" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
            <componente id="cpBarridoDetalleDUEPCom" nombre="Barrido de los Detalles del DUEP" tipo="cursor">
                <tabla schema="operation" nombre="duep_detalle">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="$config.ur$"/>
                    <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="$inParam.periodo$"/>
                    <campo name="folio_duep" filtroCampo="folio_duep" filtroOperador="=" filtroValor="$inParam.folio_duep$"/>
                        <campo name="folio_duep_detalle" />
                        <campo name="fecha_registro" calc="@fechaSistema()"/>
                        <campo name="articulo" />
                        <campo name="cantidad" />
                        <campo name="precio_unitario" />
                        <campo name="iva" />
                        <campo name="importe" />
                        <campo name="tipo_detalle" calc="1"/>
                        <campo name="u_medida" />
                        <campo name="id_cat_objeto_gasto"/>
                        <campo name="c_objeto_gasto" />
                        <campo name="id_cat_programa_presupuestal" />
                        <campo name="mes_cve_presupuestal" />
                        <campo name="clave_presupuestal"/>
                        <campo name="fecha_elaboracion" local="true" type="string" calc="@fechaSistema()"/>
                        <campo name="total"/>
       
                    
                </tabla>
                <nivel id="barrePres" nombre="Barre Presupuesto de Egresos Mensual" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar% AND %nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.clave_presupuestal%!=null"> 
                    <componente id="barrePres" nombre="Barre Presupuesto de Egresos Mensual" tipo="cursor">
                        <tabla schema="operation" nombre="presupuesto_egresos_mes_det">
                            <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$config.ur$" /> 
                            <campo name="id_periodo" filtroCampo="id_periodo" filtroOperador="=" filtroValor="$inParam.periodo$" /> 
                            
                            <campo name="clave_presupuestal" filtroCampo="clave_presupuestal" filtroOperador="=" filtroValor="%nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.clave_presupuestal%"/>
                            <campo name="mes" filtroCampo="mes" filtroOperador="=" filtroValor="%nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.mes_cve_presupuestal%"/>
                            <!--<campo name="presupuesto_precomprometido" calc="%barrePres.barrePres.presupuesto_precomprometido% - %nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.total%"/>-->
                            <campo name="presupuesto_comprometido" calc="@consultaDirec('SELECT '+%barrePres.barrePres.presupuesto_comprometido%+' + '+ %nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.total%+' AS suma','suma','numeric','MAGNITUS')"/>
                        </tabla>
                    </componente>
                </nivel>
                  <nivel id="altaDetalleDirecCargoCom" nombre="Alta Detalle Cargo de Duep" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
                    <componente id="altaDetalleDirecCargo" nombre="altaDetalleDirecCargo" tipo="altaDirect">
                        <tabla schema="operation" nombre="detalle_movimientos_auxiliares">
                            <campo name="ur" calc="%RSGC5.form_ASGXC.ur%" />
                            <campo name="id_periodo" calc="%RSGC5.form_ASGXC.periodo%"/>
                            
                            <campo name="id_movimiento_auxiliar" calc="%nlGenEncabezadoPolizaCom.cpGenEncabezadoPolizaCom.folio_movimiento_auxiliar%" />
                            <campo name="id_detalle_movimiento_auxiliar" generacion="@prox()+1" autogenerado="true"/>
                            <campo name="clave_presupuestal" calc="%nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.clave_presupuestal%"/>
                            <campo name="clave_cuenta_contable" calc="@concatenar('8'+%obSeparador.obSeparador.caracter%+
                            '2'+%obSeparador.obSeparador.caracter%+
                            '4'+%obSeparador.obSeparador.caracter%+
                            '0'+%obSeparador.obSeparador.caracter%+
                            '0'+%obSeparador.obSeparador.caracter%+
                            '01'+%obSeparador.obSeparador.caracter%+
                            '00000'+%obSeparador.obSeparador.caracter%+'000')" />
                            <campo name="importe_cargo" calc="%nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.total%"/>
                            <campo name="concepto_bloque" calc="%nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.articulo%"/>
                           <campo name="referencia" calc="@consultaDirec('SELECT descripcion FROM catalog.cuentas_contables
                                WHERE clave_cuenta ='+'\\''+ @concatenar('8'+%obSeparador.obSeparador.caracter%+
                                '2'+%obSeparador.obSeparador.caracter%+
                                '4'+%obSeparador.obSeparador.caracter%+
                                '0'+%obSeparador.obSeparador.caracter%+
                                '0'+%obSeparador.obSeparador.caracter%+
                                '01'+%obSeparador.obSeparador.caracter%+
                                '00000'+%obSeparador.obSeparador.caracter%+'000') +'\\'','descripcion','string','MAGNITUS');"/>
                            <campo name="fecha_registro" calc="@fechaSistema()" />
                            <campo name="ultimo_usuario_modificador" calc="%barreUsuarios.barreUsuarios.id_usuario%"/>
                            <campo name="tipo_detalle" calc="1"/>
                        </tabla>
                    </componente>
                </nivel> 
 
                <!-- INGRESA EL ABONO A LA PÓLIZA-->
            <nivel id="altaDetalleDirecAbonoCom" nombre="AltaDetalleDirecAbono" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
                    <componente id="altaDetalleDirecAbono" nombre="altaDetalleDirecAbono" tipo="altaDirect">
                        <tabla schema="operation" nombre="detalle_movimientos_auxiliares">
                            <campo name="ur" calc="%RSGC5.form_ASGXC.ur%" />
                            <campo name="id_periodo" calc="%RSGC5.form_ASGXC.periodo%"/>
                            
                            <campo name="id_movimiento_auxiliar" calc="%nlGenEncabezadoPolizaCom.cpGenEncabezadoPolizaCom.folio_movimiento_auxiliar%" />
                            <campo name="id_detalle_movimiento_auxiliar" generacion="@prox()+1" autogenerado="true"/>
                            <campo name="clave_presupuestal" calc="%nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.clave_presupuestal%"/>
                            <campo name="clave_cuenta_contable" calc="@concatenar('8'+%obSeparador.obSeparador.caracter%+
                            '2'+%obSeparador.obSeparador.caracter%+
                            '2'+%obSeparador.obSeparador.caracter%+
                            '0'+%obSeparador.obSeparador.caracter%+
                            '0'+%obSeparador.obSeparador.caracter%+
                            '01'+%obSeparador.obSeparador.caracter%+
                            '00000'+%obSeparador.obSeparador.caracter%+'000')" />
                            <campo name="importe_abono" calc="%nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.total%"/>
                            <campo name="concepto_bloque" calc="%nlBarridoDetalleDUEPCom.cpBarridoDetalleDUEPCom.articulo%"/>
                            <campo name="referencia" calc="@consultaDirec('SELECT descripcion FROM catalog.cuentas_contables
                                WHERE clave_cuenta ='+'\\''+ @concatenar('8'+%obSeparador.obSeparador.caracter%+
                                '2'+%obSeparador.obSeparador.caracter%+
                                '2'+%obSeparador.obSeparador.caracter%+
                                '0'+%obSeparador.obSeparador.caracter%+
                                '0'+%obSeparador.obSeparador.caracter%+
                                '01'+%obSeparador.obSeparador.caracter%+
                                '00000'+%obSeparador.obSeparador.caracter%+'000') +'\\'','descripcion','string','MAGNITUS');"/>
                            <campo name="fecha_registro" calc="@fechaSistema()" />
                            <campo name="ultimo_usuario_modificador" calc="%barreUsuarios.barreUsuarios.id_usuario%"/>
                            <campo name="tipo_detalle" calc="1"/>
                        </tabla>
                    </componente>
                </nivel>

            </componente>
        </nivel> 
            
              
        <!--FIN POLIZA--> 
        
        
            <!-- REPORTE  -->
        <nivel id="ASGXC_nivelTres" nombre="Autoriza Solicitud de Gasos por Comprobar" mostrarProximoNivel="true" mostrarNivelAnterior="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
            <componente id="PPEC" nombre="Poliza del Presupuesto de Egresos Comprometido" tipo="reporte">
                <reporte nombre="polizacontable_GGPC" expediente="Expediente de Solicitud de Gastos por Comprobar" nombreDocumento="'Póliza de Solicitud de Gasto a Comprobar'"  grupo="$inParam.folio_exp_gasto$"  url="$config.repository_upload_file$" update="true" >
                    <campo name="ur" type="long" calc="$inParam.ur$"/>
                    <campo name="periodo"  type="long" calc="$inParam.periodo$"/>
                    <campo name="folio_movimiento_auxiliar" type="long" calc="%nlGenEncabezadoPolizaCom.cpGenEncabezadoPolizaCom.folio_movimiento_auxiliar%"/>
                </reporte>
            </componente>
        </nivel>
        <!--FIN REPORTE -->
        
        <nivel nombre="Finaliza Instancia" id="finalizaInstancia" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
            <componente tipo="solicitud" nombre="finalizaInstancia" id="finalizaInstancia" >
                <parametros url="$config.request$" metodo="POST" accion="terminarInstancia" tipo="json">
                <parametro name="enterprise" calc="$protocolarios.enterprise$"/>
                <parametro name="process" calc="$protocolarios.process$"/>
                <parametro name="version" calc="$protocolarios.version$"/>
                <parametro name="instance" calc="$protocolarios.instance$"/>
                </parametros>
            </componente>
        </nivel>

      
             <!--ALTA DIRECT -->
            <nivel id="barreOficioGC" nombre="barreOficioGC" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true" >
                <componente id="barreOficioGC" nombre="barreOficioGC" tipo="cursor">
                    <tabla schema="operation" nombre="duep">
                        <campo name="ur"  filtroCampo="ur" filtroOperador="=" filtroValor="$config.ur$" />
                        <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%per.per.id_periodo%" />
                        <campo name="folio_duep" filtroCampo="folio_duep" filtroOperador="=" filtroValor="$inParam.folio_duep$"/> 
                        <campo name="funcionario_solicitante"/> 
                        <campo name="id_cat_fondo_contable" />
                        <campo name="id_fondo_contable" />
                        <campo name="concepto" />
                        
                        <campo name="total_letra"/> 
                    </tabla>
                </componente>
            </nivel>
    
            <nivel id="altaDuep" nombre="altaDuep" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
                <componente id="altaDuep" nombre="altaDuep" tipo="altaDirect">
                    <tabla schema="operation" nombre="orden_pago">
                        <campo name="ur"  calc="%barreOficioGC.barreOficioGC.ur%"/>
                        <campo name="id_periodo"  calc="%barreOficioGC.barreOficioGC.periodo%" />
                        <campo name="orden_pago" generacion="@prox()+1" autogenerado="true"/> 
                        <campo name="fecha_programacion_pago"/> 
                        <campo name="folio_orden_pago" calc="@concatenar('CLC-'+@ifThenElse(
                            @consultaDirec('
                            SELECT (folio_orden_pago) AS resultado
                            FROM operation.orden_pago
                            WHERE ur='+$inParam.ur$+' AND id_periodo='+$inParam.periodo$+' ORDER BY resultado DESC limit 1','resultado','string','MAGNITUS')==null
                            ,
                            '000001'
                            ,
                            @consultaDirec('
                            SELECT to_char((((substring(folio_orden_pago from char_length(folio_orden_pago)-4)::int)+1)),\\''+'00000'+'\\') as resultado
                            FROM operation.orden_pago
                            WHERE ur='+$inParam.ur$+' AND id_periodo='+$inParam.periodo$+' ORDER BY resultado DESC limit 1','resultado','int','MAGNITUS')))"/> 
                        <campo name="folio_duep" calc="%barreOficioGC.barreOficioGC.folio_duep%" /> 
                        <campo name="funcionario_solicitante" calc="%barreOficioGC.barreOficioGC.funcionario_solicitante%"/> 
                        <campo name="id_cat_fondo_contable" calc="%barreOficioGC.barreOficioGC.id_cat_fondo_contable%"/> 
                        <campo name="id_fondo_contable" calc="%barreOficioGC.barreOficioGC.id_fondo_contable%"/> 
                        <campo name="concepto" calc="%barreOficioGC.barreOficioGC.concepto%"/> 
                        
                        <campo name="total_letra" calc="%barreOficioGC.barreOficioGC.total_letra%"/> 
                    </tabla>
             </componente>
        </nivel>
               
               
   
            <nivel id="barreDetalleGasto" nombre="barreDetalleGasto" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
                <componente id="barreDetalleGasto" nombre="barreDetalleGasto" tipo="cursor">
                    <tabla schema="operation" nombre="duep_detalle">
                        <campo name="ur"  filtroCampo="ur" filtroOperador="=" filtroValor="$config.ur$"/>
                        <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%per.per.id_periodo%"/>
                        <campo name="folio_duep" filtroCampo="folio_duep" filtroOperador="=" filtroValor="$inParam.folio_duep$"/> 
                        <campo name="folio_duep_detalle" />
                        <campo name="articulo"/>
                        <campo name="descripcion_especifica"/> 
                        <campo name="u_medida"/>
                        <campo name="precio_unitario"/> 
                        <campo name="total"/> 
                        <campo name="importe"/> 
                        <campo name="mes_cve_presupuestal"/> 
                        <campo name="clave_presupuestal" />
                        <campo name="id_cat_fuente"/>
                        <campo name="fuente_financiamiento"/>
                    </tabla>
                    
                <nivel id="FA" nombre="Filtra Articulo" interactivo="false"> 
                    <componente id="FA" nombre="Filtra Articulo" tipo="cursor">
                        <tabla schema="catalog" nombre="articulos">
                            <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="$config.ur$"/> 
                            <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%per.per.id_periodo%"/> 
                            <campo name="clave_articulo" filtroCampo="clave_articulo" filtroOperador="=" filtroValor="%barreDetalleGasto.barreDetalleGasto.articulo%"/>
                            <campo name="descripcion_articulo"/>
                        </tabla>
                    </componente>
                </nivel>
    
            <nivel id="altaDetalleDuep" nombre="altaDetalleDuep" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
                <componente id="altaDetalleDuep" nombre="altaDetalleDuep" tipo="altaDirect">
                    <tabla schema="operation" nombre="orden_pago_detalle">
                        <campo name="ur" calc="%barreDetalleGasto.barreDetalleGasto.ur%"/>
                        <campo name="id_periodo" calc="%barreDetalleGasto.barreDetalleGasto.periodo%"/>
                        <campo name="orden_pago" calc="%altaDuep.altaDuep.orden_pago%"/> 
                        <campo name="id_detalle_orden_pago" generacion="@prox()+1" autogenerado="true" />
                        <campo name="folio_duep" calc="%barreDetalleGasto.barreDetalleGasto.folio_duep%"/>
                        <campo name="concepto" calc="%FA.FA.descripcion_articulo%"/> 
                        <campo name="fecha_registro" calc="@fechaSistema(&quot;YYYY/MM/dd HH:mm:ss&quot;)"/>
                        <campo name="descripcion_especifica" calc="%barreDetalleGasto.barreDetalleGasto.descripcion_especifica%"/> 
                        <campo name="u_medida" calc="%barreDetalleGasto.barreDetalleGasto.u_medida%"/>
                        <campo name="cantidad" calc="@consultaDirec('SELECT (cantidad)::int as result from operation.duep_detalle where ur='+$config.ur$+' AND periodo='+%per.per.id_periodo%+' AND folio_duep='+$inParam.folio_duep$,'result','long','MAGNITUS')"/>
                        <campo name="precio_unitario" calc="%barreDetalleGasto.barreDetalleGasto.precio_unitario%"/> 
                        <campo name="total_estimado" calc="%barreDetalleGasto.barreDetalleGasto.importe%"/> 
                        <campo name="total" calc="%barreDetalleGasto.barreDetalleGasto.total%" /> 
                        <campo name="cve_mes_pre" calc="%barreDetalleGasto.barreDetalleGasto.cve_mes_pre%"/> 
                        <campo name="clave_presupuestal" calc="%barreDetalleGasto.barreDetalleGasto.clave_presupuestal%"/> 
                        <campo name="importe"  calc="%barreDetalleGasto.barreDetalleGasto.importe%"/>
                        <campo name="id_cat_fuente_financiamiento"  calc="%barreDetalleGasto.barreDetalleGasto.id_cat_fuente%"/>
                        <campo name="id_fuente_financiamiento"  calc="%barreDetalleGasto.barreDetalleGasto.fuente_financiamiento%"/>
                        <campo name="folio_duep_detalle"  calc="%barreDetalleGasto.barreDetalleGasto.folio_duep_detalle%"/>
                    </tabla>
                </componente>
            </nivel>
       </componente>
    </nivel>


        <!--INSTANCIAS-->

        <nivel nombre="InstanciaOrden_Pago" id="IOP" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==true">
            <componente tipo="solicitud" nombre="EnvioParametrosDynamo" id="IOP">
                <parametros url="$config.request$" metodo="POST" accion="crearNuevaInstancia" tipo="json">
                    <parametro name="enterprise" calc="'MAGNITUS'"/>
                    <parametro name="process" calc="'c3bef35f-9a12-472d-b78b-b2c80e3a9eff'"/>
                    <parametro name="out_ur" calc="$inParam.ur$" />
                    <parametro name="out_periodo" calc="$inParam.periodo$" />
                    <parametro name="out_folio_duep" calc="$inParam.folio_duep$" />
                    <parametro name="out_folio_duep_detalle" calc="%RSGC3.RSGC3.folio_duep_detalle%" />
                    <parametro name="out_orden_pago" calc="%altaDuep.altaDuep.orden_pago%" /> 
                    <parametro name="out_folio_expediente" calc="$inParam.folio_exp_gasto$"/>
                    <parametro name="out_tipo_expediente" calc="'2'"/>
                </parametros>
            </componente>
        </nivel>
        
        <nivel nombre="Instancia Validador" id="InstanciaVal" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==false"> 
           <componente tipo="solicitud" nombre="EnvioParametrosDynamo" id="InstanciaVal"> 
               <parametros url="$config.request$" metodo="POST" accion="agregarMensaje" tipo="json">
                   <parametro name="enterprise" calc="$protocolarios.enterprise$"/> 
                   <parametro name="process" calc="$protocolarios.process$"/>    
                   <parametro name="version" calc="$protocolarios.version$"/> 
                   <parametro name="user" calc="$protocolarios.user$"/>  
                   <parametro name="instance" calc="$protocolarios.instance$"/> 
                   <parametro name="message" calc="%RSGC5.form_ASGXC.motivo_rechazo_autoriza%"/>
                   <parametro name="type" calc="'1'"/> 
               </parametros> 
           </componente>
       </nivel>
       
            <nivel nombre="TurnarInstancia" id="EnlaceDynamo" interactivo="false" ejecutar="%RSGC5.form_ASGXC.autoriza_gasto_comprobar%==false">
            <componente tipo="solicitud" nombre="Enlace con dynamo" id="EnlaceDynamo1">
                <parametros url="$config.request$" metodo="POST" accion="negociarInstancia" tipo="json">
                    <parametro name="enterprise" calc="$protocolarios.enterprise$"/>
                    <parametro name="process" calc="$protocolarios.process$"/>
                    <parametro name="version" calc="$protocolarios.version$"/>
                    <parametro name="instance" calc="$protocolarios.instance$"/>
                    <parametro name="user" calc="$protocolarios.user$"/>
                    <parametro name="url" calc="$protocolarios.url$"/>
                    <parametro name="reiniciarInstancia" calc="'true'" />
                </parametros>
            </componente>
        </nivel>
    </pagina>
</tarea>