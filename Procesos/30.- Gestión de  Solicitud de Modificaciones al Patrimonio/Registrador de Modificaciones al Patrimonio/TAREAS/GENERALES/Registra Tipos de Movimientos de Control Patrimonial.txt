<?xml version="1.0" standalone="yes"?>
<tarea nombre="alta_usuario" id="BuscaResultado" autor="Marisela">
    <pagina id="1" nombre="Registro">
	   <nivel id="per" nombre="per" interactivo="false">
                <componente tipo="cursor" id="per" nombre="per">
                    <tabla schema="catalog" nombre="periodo">
                        <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$config.ur$"/>
                        <campo name="id_periodo"/>
                        <campo name="estatus" filtroCampo="estatus" filtroOperador="=" filtroValor="true"/>
                        <campo name="id_estatus" filtroCampo="id_estatus" filtroOperador="=" filtroValor="3"/>
                        <campo name="folio_compras" text="folio_compras" local="true" type="string" calc="@concatenar('AF-'+@ifThenElse(
                        @consultaDirec('
                        SELECT (id_activo_fijo) AS resultado
                        FROM operation.activo_fijo_aux
                        WHERE ur='+$config.ur$+' AND periodo='+%per.per.id_periodo%+' ORDER BY resultado DESC limit 1','resultado','string','MAGNITUS')==null
                        ,
                        '000001'
                        ,
                        @consultaDirec('
                        SELECT to_char((((substring(id_activo_fijo from char_length(id_activo_fijo)-4)::int)+1)),\\''+'00000'+'\\') as resultado
                        FROM operation.activo_fijo_aux
                        WHERE ur='+$config.ur$+' AND periodo='+%per.per.id_periodo%+' ORDER BY id_activo_fijo DESC limit 1','resultado','string','MAGNITUS')
                        ))" habilitado="false"/>
                    <campo name="letras" local="true" type="string" text="Contrato" calc="@subCadena(%per.per.folio_compras%,0,3)"/>
                    <campo name="numeros" local="true" type="string" text="Contrato" calc="@subCadena(%per.per.folio_compras%,4,9)"/>
                    </tabla>
                </componente>
            </nivel>
            <nivel id="barreUsuarios" nombre="barreUsuarios" interactivo="false">
                <componente id="barreUsuarios" nombre="barreUsuarios" tipo="cursor">
                    <tabla schema="entity" nombre="usuario">
                        <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$config.ur$"/>
                        <campo name="id_usuario"/>
                        <campo name="permisos_especiales"/>
                        <campo name="nombre_usuario" filtroCampo="nombre_usuario" filtroOperador="=" filtroValor="$protocolarios.user$"/>
                    </tabla>
                </componente>
            </nivel>
	   <nivel nombre="Reg_Usr" id="re" mostrarProximoNivel="false" mostrarNivelAnterior="false">
            <componente tipo="formulario" id="re" nombre="Datos Generales del Tipo de Movimiento">
                <tabla schema="operation" nombre="activo_fijo_aux">
                    <campo name="ur" text="ur" calc="$config.ur$" visible="false" llaveForanea="false"/>
                    <campo name="periodo" text="periodo" calc="%per.per.id_periodo%" visible="false" llaveForanea="false"/>
                   
                    <campo name="id_activo_fijo" text="id_activo_fijo" calc="%per.per.letras%+%per.per.numeros%" visible="false"/>
                    <campo name="fecha_elaboracion" text="Fecha de Alta" calc="@fechaSistema(&quot;YYYY/MM/dd HH:mm:ss&quot;)" habilitado="false" visible="false"/>
                    <!--autoFiltradoDescripcion="tipo_movimiento" autoFiltrado="true"-->
                    <!--autoFiltradoDescripcion="transaccion" autoFiltrado="true"-->
                    <campo name="tipo_movimiento" text="Tipo de Movimiento *" descripcionForanea="descripcion" llavesFijas="id_tipo_movimiento=1 OR id_tipo_movimiento=2 OR id_tipo_movimiento=3 OR id_tipo_movimiento=4 OR id_tipo_movimiento=5"  validacion="%tipo_movimiento%==null" validacionMensaje="El campo Tipo de Movimiento no puede ir vacio." columnas="2" margen-izquierdo="3"/>
                    <campo name="transaccion" text="Transacción *" descripcionForanea="transaccion"  validacion="%transaccion%==null" validacionMensaje="Debe de Capturar Apellido" columnas="2" margen-derecho="3"/>
                    <campo name="justificacion" text="Justificación *" validacion="%justificacion%==null" validacionMensaje="Seleccione Transacción" columnas="2" margen-izquierdo="3"/>
                    <campo name="estatus" text="Estatus" calc="'En proceso'" columnas="2"  margen-derecho="3"/>
                </tabla>
                <estilos>
                    <boton nombre="grabar" visible="true" texto="Grabar" hacer="saltar siguiente nivel"  columnas="2" margen-izquierdo="4"/>
                    
                </estilos>
                <acciones>
                    <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
            </componente>
        </nivel>
        
        
        <!--ALTA -->
        
        <nivel id="ipcmd" nombre="Registra Recepción de Bienes" mostrarNivelAnterior="false" mostrarProximoNivel="true" ejecutar="%re.re.tipo_movimiento%==1 OR %re.re.tipo_movimiento%==4"> 
                <componente tipo="maestroDetalle" id="ipcmd" nombre="Registra Recepción de Bienes"> 
                    <encabezado accionDefault="editar">
                        <tabla schema="operation" nombre="activo_fijo_aux">
                            <campo name="ur" text="Unidad Responsable" visible="false" llaveForanea="false" calc="$config.ur$" habilitado="false"/>
                            <campo name="periodo" text="Periodo" visible="false" calc="%re.re.periodo%" habilitado="false" llaveForanea="false"/>
                            <campo name="id_activo_fijo" text="Folio" calc="%re.re.id_activo_fijo%" columnas="2" margen-izquierdo="3"/>
                            <campo name="clave_almacen" text="Clave de Almacén" descripcionForanea="clave_alamcen" columnas="2" margen-derecho="3"/>
                            <campo name="fecha_elaboracion" text="Fecha" calc="@fechaSistema(&quot;DD-MM-YYYY&quot;)" habilitado="%barreUsuarios.barreUsuarios.permisos_especiales%==true" columnas="2" margen-izquierdo="3"/>
                            <campo name="descripcion_almacen" text="Descripción de Almacén" referenciaForanea="clave_almacen" celdaForanea="nombre" autocompletar="true" columnas="2" margen-derecho="3"/>
                            <campo name="tipo_movimiento" text="Tipo de Movimiento" descripcionForanea="descripcion" columnas="2" margen-izquierdo="3" habilitado="false"/>
                            <campo name="excel" type="file" text="Adjunta Excel" cellsalign="left" width="110" local="true" fileType="normal" url="$config.repository_upload_file$" nombreDocumento="''" grupo="" expediente="" columnas="2" margen-derecho="3"/>
                            <campo name="transaccion" text="Transacción" descripcionForanea="transaccion" columnas="2" margen-izquierdo="3" habilitado="false"/>
                            <campo name="documentacion" type="file" text="Adjuntar Documentación" cellsalign="left" width="110" local="true" fileType="normal" url="$config.repository_upload_file$" nombreDocumento="''" grupo="" expediente="" columnas="2" margen-derecho="3"/>
                            <campo name="justificacion" text="Justificación" width="110" height="200" columnas="4" margen-izquierdo="3"/>
                        </tabla>
                            <estilos>
                                <boton nombre="grabar" visible="true" texto="Guardar" columnas="2" margen-izquierdo="4"/>
                            </estilos>
                            <acciones>
                                <accion nombre="grabar" hacer="saltar siguiente componente"/>
                            </acciones>
                    </encabezado>
                    <detalles>
                        <tabla schema="operation" nombre="activo_fijo_det_aux" tituloDetalle="Bloques" id="detalle_uno" mostrarEliminar="false">
                            <!--Bloque Presupuestal-->
                            <campo name="ur" text="Unidad Responsable" llaveForanea="false" visible="false" columna-visible="false" calc="$config.ur$"/>
                            <campo name="periodo" text="Periodo" llaveForanea="false" visible="false" columna-visible="false" calc="%per.per.id_periodo%"/>
                            <campo name="id_activo_fijo" text="id_activo_fijo" calc="%re.re.id_activo_fijo%" llaveForanea="false" visible="false" columna-visible="false"/>
                            <campo name="id_activo_fijo_det_aux" text="id_activo_fijo" generacion="@prox()+1" autogenerado="true" visible="false"/>
                            <campo name="id_cat_clasificacion_objeto_gasto" text="Clasificador por Objeto del Gasto" calc="4" visible="false"/>
                            
                            <campo name="clave_articulo" text="Clave artículo" autoFiltradoDescripcion="clave_articulo,descripcion_articulo" autoFiltrado="true" descripcionForanea="clave_articulo,descripcion_articulo" columnas="3" margen-izquierdo="2"/>
                            <campo name="serie" text="Serie " columnas="3" margen-derecho="2"/>
                            <campo name="descripcion_especifica" text="Descripción Específica" width="110" height="200" referenciaForanea="clave_articulo" celdaForanea="descripcion_articulo" autocompletar="true" columnas="6" margen-izquierdo="2" columna-visible="false"/>
                            <campo name="color" text="Color" columnas="3" margen-izquierdo="2"/>
                            <campo name="factura" text="Factura" columnas="3" margen-derecho="2"/>
                            <campo name="unidad_medida" text="Unidad de Medida"  habilitado="false" referenciaForanea="clave_articulo" celdaForanea="unidad_medida" autocompletar="true" columnas="3" margen-izquierdo="2"/>
                            <campo name="fecha_factura" text="Fecha Factura" columnas="3" margen-derecho="2" validacion="@after(%fecha_factura%,@fechaSistema())" validacionMensaje="La fecha no puede ser mayor a hoy"/>
                            <campo name="cantidad" text="Cantidad" calc="1" columnas="3" margen-izquierdo="2"/>
                            <campo name="ano_adquisicion" text="Año Adquisición" calcCliente="@subCadena(%fecha_factura%,0,4)" columnas="3" margen-derecho="2" habilitado="false"/>
                            <campo name="costo_unitario" text="Costo Unitario" columnas="3" margen-izquierdo="2"/>
                            <campo name="clasificacion_objeto_gasto" text="Clasificador por Objeto del Gasto" habilitado="false" descripcionForanea="id_cat" referenciaForanea="clave_articulo" celdaForanea="id_cat_clasificacion_objeto_gasto" autocompletar="true" columnas="3" margen-derecho="2"/>
                            <campo name="cuenta_amortizacion" text="Cuenta Armonizada" autoFiltradoDescripcion="cuenta_amortizacion" autoFiltrado="true" descripcionForanea="clave_cuenta,descripcion" columnas="3" margen-izquierdo="2"/>
                            <campo name="marca" text="Marca" columnas="3" margen-derecho="2"/>
                            <!--<campo name="aplica_depreciacion" text="Aplica Depreciación" columnas="3" margen-izquierdo="2">
                                	<opciones>
                            		<opcion texto="Si" valor="Si"/>
                            		<opcion texto="No" valor="No"/>
                            	</opciones>
                            </campo> -->

                            <campo name="modelo" text="Modelo" columnas="3" margen-izquierdo="2"/>
                            <!--<campo name="depreciacion" text="% Depreciación" columnas="3" margen-izquierdo="2"/>-->
                            <campo name="almacen" text="almacen" calc="%ipcmd.ipcmd.descripcion_almacen%" visible="false" columna-visible="false"/>
                            <campo name="total" text="total" calcCliente="@ifThenElse(%costo_unitario%==null,0,%costo_unitario%)*@ifThenElse(%cantidad%==null,0,%cantidad%)" visible="false" columna-visible="false"/>
                        </tabla>
                        
                                </detalles>
                       <!--SUMATORIA-->
                    <!--<pie>
                        <tabla schema="operation" nombre="trans_extrapresupuestal" tituloPie="Titulo de Detalle de movimiento Pie">
                            <campo name="importe" text="Importe Total"/>
                            <campo name="importe_total_abono" text="Importe Total de Abono"/>
                            <campo name="folio_movimiento_auxiliar" text="Folio de Póliza"/>
                        </tabla>
                    </pie>-->
                <acciones>
                        <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
                <estilos>
                    <boton nombre="grabar" posicion="derecha" visible="true" texto="avanzar a nivel"/>
                </estilos>
                </componente>
            </nivel>
        
<nivel nombre="Modificacion del patrimonio" id="gsmpa" interactivo="false" ejecutar="%re.re.tipo_movimiento%==1 OR %re.re.tipo_movimiento%==4">
            <componente tipo="solicitud" nombre="Modificacion del patrimonioo" id="gsmpa">
                <parametros url="$config.request$" metodo="POST" accion="crearNuevaInstancia" tipo="json">
                    <parametro name="enterprise" calc="'MAGNITUS'"/>
                    <parametro name="process" calc="'4232ed49-6f50-461b-858e-cfa72932c2af'"/>
                    <parametro name="out_ur" calc="$config.ur$" mostrarEsc="true"/>
                    <parametro name="out_periodo" calc="%per.per.id_periodo%" mostrarEsc="true"/>
                    <parametro name="out_id_activo_fijo" calc="%re.re.id_activo_fijo%" mostrarEsc="true"/>
                    <parametro name="out_tipo_movimiento" calc="%re.re.tipo_movimiento%" mostrarEsc="true"/>
                     <parametro name="out_transaccion" calc="%re.re.transaccion%" mostrarEsc="true"/>
                     <parametro name="out_justificacion" calc="%re.re.justificacion%" mostrarEsc="true"/>
                     <parametro name="out_fecha_elaboracion" calc="%ipcmd.ipcmd.fecha_elaboracion%" mostrarEsc="true"/>
                     <parametro name="out_clave_almacen" calc="%ipcmd.ipcmd.clave_almacen%" mostrarEsc="true"/>
                     <parametro name="out_descripcion_almacen" calc="%ipcmd.ipcmd.descripcion_almacen%" mostrarEsc="true"/>
                     <parametro name="user" calc="$protocolarios.user$" mostrarEsc="true"/>
                </parametros>
            </componente>
        </nivel>

             <nivel nombre="CONSULTA DE ALTAS DE PATRIMONIO" id="alta" mostrarNivelAnterior="false" mostrarProximoNivel="false" ejecutar="%re.re.tipo_movimiento%==1 OR %re.re.tipo_movimiento%==4">
                <componente tipo="reporte" nombre="CONSULTA DE ALTAS DE PATRIMONIO" id="alta">
                    <reporte nombre="R_Alta_Patrimonio_IJ" id="compras"><!--expediente="" nombreDocumento="" grupo="" url="$config.repository_upload_file$"-->
                        <campo name="ur" type="long"  calc="%per.per.id_unidad_responsable%"/>
                        <campo name="periodo" type="long" calc="%per.per.id_periodo%"/>
                        <campo name="activo_fijo" type="string" calc="%re.re.id_activo_fijo%"/>
                        <campo name="usuario" type="string" calc="%barreUsuarios.barreUsuarios.nombre_usuario%"/>
                    </reporte>
                </componente>
            </nivel>    
        <!--ALTA -->
        <!--BAJA -->
            
            <nivel id="ipcmd2" nombre="Registra Baja de Patrimonio" mostrarNivelAnterior="false" mostrarProximoNivel="true" ejecutar="%re.re.tipo_movimiento%==2 OR %re.re.tipo_movimiento%==5"> 
                <componente tipo="maestroDetalle" id="ipcmd2" nombre="Registra Baja de Patrimonio"> 
                    <encabezado accionDefault="editar">
                        <tabla schema="operation" nombre="activo_fijo_aux">
                            <campo name="ur" text="Unidad Responsable" visible="false" llaveForanea="false" calc="$config.ur$" habilitado="false"/>
                            <campo name="periodo" text="Periodo" visible="false" calc="%per.per.id_periodo%" habilitado="false" llaveForanea="false"/>
                            <campo name="id_cat_area_requiriente" text="Centro de Registro" calc="2" visible="false"/>
                            <campo name="area_requiriente" text="Centro de Registro" columnas="3" margen-izquierdo="2"/>
                            <campo name="clave_almacen" text="Clave de Almacén" descripcionForanea="clave_alamcen" columnas="3" margen-derecho="2"/>
                            <campo name="id_activo_fijo" text="Folio" calc="%re.re.id_activo_fijo%" columnas="3" margen-izquierdo="2"/>
                            <campo name="descripcion_almacen" text="Descripción de Almacén" referenciaForanea="clave_almacen" celdaForanea="nombre" autocompletar="true" columnas="3" margen-derecho="2"/>
                            <campo name="fecha_elaboracion" text="Fecha" columnas="3" margen-izquierdo="2"/>
                            <campo name="tipo_movimiento" text="Tipo de Movimiento" calc="%re.re.tipo_movimiento%" descripcionForanea="descripcion" columnas="3" margen-derecho="2"/>
                            <campo name="excel" type="file" text="Adjunta Excel" cellsalign="left" width="110" local="true" fileType="normal" url="$config.repository_upload_file$" nombreDocumento="''" grupo="" expediente="" columnas="3" margen-izquierdo="2"/>
                            <campo name="transaccion" text="Transacción" descripcionForanea="transaccion" calc="%re.re.transaccion%" columnas="3" margen-derecho="2"/>
                            <campo name="documentacion" type="file" text="Adjuntar Documentación" cellsalign="left" width="110" local="true" fileType="normal" url="$config.repository_upload_file$" nombreDocumento="''" grupo="" expediente="" columnas="3" margen-izquierdo="2"/>
                            <campo name="justificacion" text="Justificación" columnas="3" margen-derecho="2"/>

                        </tabla>
                        <acciones>
                            <accion nombre="grabar" hacer="saltar siguiente componente"/>
                    </acciones>
                    <estilos>
                        <boton nombre="grabar" posicion="derecha" visible="true" texto="avanzar a nivel" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                    </estilos>
                    </encabezado>
                    <detalles>
                        <tabla schema="operation" nombre="activo_fijo_det_aux" tituloDetalle="Bloques" id="detalle_uno2" mostrarEliminar="false">
                            <!--Bloque Presupuestal-->
                            <campo name="ur" text="Unidad Responsable" llaveForanea="false" visible="false" columna-visible="false" calc="$config.ur$"/>
                            <campo name="periodo" text="Periodo" llaveForanea="false" visible="false" columna-visible="false" calc="%per.per.id_periodo%"/>
                            <campo name="id_activo_fijo" text="id_activo_fijo" calc="%re.re.id_activo_fijo%" llaveForanea="false" visible="false" columna-visible="false"/>
                            <campo name="id_activo_fijo_det_aux" text="id_activo_fijo" generacion="@prox()+1" autogenerado="true" visible="false"/>
                            <campo name="id_cat_clasificacion_objeto_gasto" text="Clasificador por Objeto del Gasto" calc="4" visible="false"/>
                            
                            <campo name="clave_articulo" text="Clave artículo" autoFiltradoDescripcion="clave_articulo,descripcion_articulo" autoFiltrado="true" descripcionForanea="clave_articulo,descripcion_articulo" columnas="3" margen-izquierdo="2"/>
                            <campo name="serie" text="Serie " columnas="3" margen-derecho="2"/>
                            <campo name="descripcion_especifica" text="Descripción Específica" width="110" height="200" referenciaForanea="clave_articulo" celdaForanea="descripcion_articulo" autocompletar="true" columnas="6" margen-izquierdo="2" />
                            <campo name="color" text="Color" columnas="3" margen-izquierdo="2"/>
                            <campo name="factura" text="Factura" columnas="3" margen-derecho="2"/>
                            <campo name="unidad_medida" text="Unidad de Medida"  habilitado="false" referenciaForanea="clave_articulo" celdaForanea="unidad_medida" autocompletar="true" columnas="3" margen-izquierdo="2"/>
                            <campo name="fecha_factura" text="Fecha Factura" columnas="3" margen-derecho="2"/>
                            <campo name="cantidad" text="Cantidad" calc="1" columnas="3" margen-izquierdo="2"/>
                            <campo name="ano_adquisicion" text="Año Adquisición" calcCliente="@subCadena(%fecha_factura%,0,4)" columnas="3" margen-derecho="2" habilitado="false"/>
                            <campo name="costo_unitario" text="Costo Unitario" columnas="3" margen-izquierdo="2"/>
                            <campo name="clasificacion_objeto_gasto" text="Clasificador por Objeto del Gasto" habilitado="false" descripcionForanea="id_cat" referenciaForanea="clave_articulo" celdaForanea="id_cat_clasificacion_objeto_gasto" autocompletar="true" columnas="3" margen-derecho="2"/>
                            <campo name="cuenta_amortizacion" text="Cuenta Armonizada" autoFiltradoDescripcion="cuenta_amortizacion" autoFiltrado="true" descripcionForanea="clave_cuenta,descripcion" columnas="3" margen-izquierdo="2"/>
                            <campo name="marca" text="Marca" columnas="3" margen-derecho="2"/>
                            <campo name="aplica_depreciacion" text="Aplica Depreciación" columnas="3" margen-izquierdo="2">
                                	<opciones>
                            		<opcion texto="Si" valor="Si"/>
                            		<opcion texto="No" valor="No"/>
                            	</opciones>
                            </campo> 

                            <campo name="modelo" text="Modelo" columnas="3" margen-derecho="2"/>
                            <campo name="depreciacion" text="% Depreciación" columnas="3" margen-izquierdo="2"/>
                            <campo name="almacen" text="almacen" calc="%ipcmd2.ipcmd2.descripcion_almacen%" visible="false" columna-visible="false"/>
                            <campo name="total" text="total" calcCliente="@ifThenElse(%costo_unitario%==null,0,%costo_unitario%)*@ifThenElse(%cantidad%==null,0,%cantidad%)" visible="false" columna-visible="false"/>
                        </tabla>
                        <!--<acciones>-->
                        <!--<accion nombre="grabar" hacer="saltar siguiente nivel"/>-->
                        <!--    </acciones>-->
                        <!--    <estilos>-->
                        <!--        <boton nombre="grabar" posicion="derecha" visible="true" texto="avanzar a nivel" />-->
                        <!--    </estilos>-->
                                </detalles>
                       <!--SUMATORIA-->
                    <!--<pie>
                        <tabla schema="operation" nombre="trans_extrapresupuestal" tituloPie="Titulo de Detalle de movimiento Pie">
                            <campo name="importe" text="Importe Total"/>
                            <campo name="importe_total_abono" text="Importe Total de Abono"/>
                            <campo name="folio_movimiento_auxiliar" text="Folio de Póliza"/>
                        </tabla>
                    </pie>-->
                <acciones>
                        <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
                <estilos>
                    <boton nombre="grabar" posicion="derecha" visible="true" texto="avanzar a nivel" />
                </estilos>
                </componente>
            </nivel>
            <nivel nombre="Modificacion del patrimonio" id="gsmpb" interactivo="false" ejecutar="%re.re.tipo_movimiento%==2 OR %re.re.tipo_movimiento%==5">
            <componente tipo="solicitud" nombre="Modificacion del patrimonioo" id="gsmpb">
                <parametros url="$config.request$" metodo="POST" accion="crearNuevaInstancia" tipo="json">
                    <parametro name="enterprise" calc="'MAGNITUS'"/>
                    <parametro name="process" calc="'4232ed49-6f50-461b-858e-cfa72932c2af'"/>
                    <parametro name="out_ur" calc="$config.ur$" mostrarEsc="true"/>
                    <parametro name="out_periodo" calc="%per.per.id_periodo%" mostrarEsc="true"/>
                    <parametro name="out_id_activo_fijo" calc="%re.re.id_activo_fijo%" mostrarEsc="true"/>
                    <parametro name="out_tipo_movimiento" calc="%re.re.tipo_movimiento%" mostrarEsc="true"/>
                     <parametro name="out_transaccion" calc="%re.re.transaccion%" mostrarEsc="true"/>
                     <parametro name="out_justificacion" calc="%re.re.justificacion%" mostrarEsc="true"/>
                     <parametro name="out_clave_almacen" calc="%ipcmd2.ipcmd2.clave_almacen%" mostrarEsc="true"/>
                     <parametro name="out_descripcion_almacen" calc="%ipcmd2.ipcmd2.descripcion_almacen%" mostrarEsc="true"/>
                     <parametro name="out_area_requiriente" calc="%ipcmd2.ipcmd2.area_requiriente%" mostrarEsc="true"/>
                     <parametro name="out_fecha_elaboracion" calc="%ipcmd2.ipcmd2.fecha_elaboracion%" mostrarEsc="true"/>
                     <parametro name="user" calc="$protocolarios.user$" mostrarEsc="true"/>
                </parametros>
            </componente>
        </nivel>
             <nivel nombre="CONSULTA DE BAJA DE PATRIMONIO" id="baja" mostrarProximoNivel="false" mostrarNivelAnterior="false" ejecutar="%re.re.tipo_movimiento%==2 OR %re.re.tipo_movimiento%==5">
                <componente tipo="reporte" nombre="CONSULTA DE BAJA DE PATRIMONIO" id="baja">
                    <reporte nombre="R_Baja_Almacen_IJ" id="compras"><!--expediente="" nombreDocumento="" grupo="" url="$config.repository_upload_file$"-->
                        <campo name="ur" type="long"  calc="%per.per.id_unidad_responsable%"/>
                        <campo name="periodo" type="long" calc="%per.per.id_periodo%"/>
                        <campo name="id_activo_fijo" type="string" calc="%re.re.id_activo_fijo%"/>
                        <campo name="usuario" type="string" calc="%barreUsuarios.barreUsuarios.nombre_usuario%"/>
                    </reporte>
                </componente>
            </nivel>    
     <!--BAJA -->
      <!--TRASPASO -->
            <nivel id="dat" nombre="Detalle de Artículos de Traspaso" ejecutar="%re.re.tipo_movimiento%==3" mostrarNivelAnterior="false" mostrarProximoNivel="false">
                            <componente id="dat" nombre="Detalle de Artículos de Traspaso" tipo="tabla" mostrarEliminar="true" mostarEditar="true" mostrarAgregar="true">
                                <tabla schema="operation" nombre="almacenes">
                                    <campo name="ur" text="Unidad Responsable" llaveForanea="false" visible="false" columna-visible="false" calc="$config.ur$"/>
                                    <campo name="id_periodo" text="Periodo" llaveForanea="false" visible="false" columna-visible="false" calc="%per.per.id_periodo%"/>
                                    <campo name="id_almacenes" text="id_almacenes" columna-visible="false" visible="false" generacion="@prox()+1" autogenerado="true"/>
                                   <campo name="clave_articulo" text="Clave artículo" autoFiltradoDescripcion="clave_articulo,descripcion_articulo" autoFiltrado="true" descripcionForanea="clave_articulo,descripcion_articulo" columnas="3" margen-izquierdo="2"/>
                            
                                   <campo name="descripcion_especifica" text="Descripción Específica" columnas="3" margen-derecho="2"/>
                                     <campo name="unidad_medida" text="Unidad de Medida"  habilitado="false" referenciaForanea="clave_articulo"  autocompletar="true" columnas="3" margen-izquierdo="2"/> <!--celdaForanea="unidad_medida"-->
                                    <campo name="almacen" text="Almacén" columnas="3" margen-derecho="2"/>
                                    <campo name="existencias" text="Existencia" columnas="3" margen-izquierdo="2"/>
                                    <campo name="cantidad_traspaso" text="Cantidad Traspaso" columnas="3" margen-derecho="2"/>
                                    <campo name="costo_unitario" text="Costo Unitario" columnas="3" margen-izquierdo="2"/>
                                    <campo name="total" text="Costo Total" columnas="3" margen-derecho="2"/>
                                    <campo name="seleccion" text="Selección" filtroCampo="seleccion" filtroOperador="=" filtroValor="true" columnas="3" margen-izquierdo="2"/>-->
                                </tabla>
                                <acciones>
                        <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                            </acciones>
                            <estilos>
                                <boton nombre="grabar" posicion="derecha" visible="true" texto="avanzar a nivel" />
                            </estilos>
                            </componente>
                        </nivel>
                        
                        <nivel id="aacf" nombre="Datos Generales del Traspaso" interactivo="false" ejecutar="%re.re.tipo_movimiento%==3">
                            <componente id="aacf" nombre="Datos Generales del Traspaso" tipo="altaDirect">
                                <tabla schema="operation" nombre="activo_fijo_aux">
                                    <campo name="ur" calc="%per.per.id_unidad_responsable%"/>
                                    <campo name="periodo" calc="%per.per.id_periodo%"/>
                                    <campo name="id_activo_fijo" calc="%per.per.letras%+%per.per.numeros%"/>
                                    <campo name="tipo_movimiento" calc="%re.re.tipo_movimiento%"/>
                                    <campo name="fecha_elaboracion" calc="@fechaSistema(&quot;YYYY/MM/dd HH:mm:ss&quot;)"/>
                                    <campo name="justificacion" calc="%re.re.justificacion%"/>
                                    <campo name="transaccion" calc="%re.re.transaccion%"/>
                                    
                                </tabla>
                            </componente>
                        </nivel>
                        <nivel id="bta" nombre="barre tarjeta de almacen" interactivo="false" ejecutar="%re.re.tipo_movimiento%==3">
                            <componente id="bta" nombre="Datos Generales del Traspaso" tipo="cursor">
                                <tabla schema="operation" nombre="almacenes">
                                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%per.per.id_unidad_responsable%"/>
                                    <campo name="id_periodo" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%per.per.id_periodo%"/>
                                    <campo name="id_almacenes"/>
                                    <campo name="clave_articulo" text="Clave artículo"/> 
                                    <campo name="descripcion_especifica" text="Descripción Específica"/>
                                    <campo name="unidad_medida" text="Unidad de Medida"/>
                                    <campo name="almacen" text="Almacén"/>
                                    <campo name="existencias" text="Existencia"/>
                                    <campo name="cantidad_traspaso" text="Cantidad Traspaso"/>
                                    <campo name="costo_unitario" text="Costo Unitario"/>
                                    <campo name="total" text="Costo Total"/>
                                    <campo name="seleccion" text="Selección" filtroCampo="seleccion" filtroOperador="=" filtroValor="true"/>
                                    <!--<campo name="folio_af" text="folio_af" filtroCampo="folio_af" filtroOperador="=" filtroValor="'0'"/>-->
                                </tabla>
                                <nivel id="aa" nombre="alta en activo fijo detalle" interactivo="false" ejecutar="%re.re.tipo_movimiento%==3">
                                    <componente id="aa" nombre="alta en activo fijo detalle" tipo="altaDirect">
                                        <tabla schema="operation" nombre="activo_fijo_det_aux">
                                            <campo name="ur" calc="%per.per.id_unidad_responsable%"/>
                                            <campo name="periodo" calc="%per.per.id_periodo%"/>
                                            <campo name="id_activo_fijo" calc="%per.per.letras%+%per.per.numeros%"/>
                                            <campo name="id_activo_fijo_det_aux" autogenerado="true" generacion="@prox()+1"/>
                                            <campo name="fecha_elaboracion" calc="@fechaSistema(&quot;YYYY/MM/dd HH:mm:ss&quot;)"/>
                                            
                                            <campo name="clave_articulo" calc="%bta.bta.tipo_movimiento%"/>
                                            <campo name="descripcion_especifica" calc="%bta.bta.descripcion_especifica%"/>
                                            <campo name="unidad_medida" calc="%bta.bta.unidad_medida%"/>
                                            <campo name="almacen" calc="%ipcmd2.ipcmd2.clave_almacen%"/>
                                            <campo name="existencias" calc="%bta.bta.existencia%"/>
                                            <campo name="cantidad_traspaso" calc="%bta.bta.catidad_traspaso%"/>
                                            <campo name="costo_unitario" calc="%bta.bta.costo_unitario%"/>
                                            <campo name="total" calc="%bta.bta.total%"/>
                                        </tabla>
                                    </componente>
                                </nivel>
                            </componente>
                        </nivel>
                        <nivel id="aaf" nombre="Datos Generales del Traspaso" mostrarNivelAnterior="false" mostrarProximoNivel="false" ejecutar="%re.re.tipo_movimiento%==3">
                            <componente id="aaf" nombre="Datos Generales del Traspaso" tipo="formulario" accionDefault="editar">
                                <tabla schema="operation" nombre="activo_fijo_aux">
                                    <campo name="ur" calc="%per.per.id_unidad_responsable%" visible="false" llaveForanea="false"/>
                                    <campo name="periodo" calc="%per.per.id_periodo%" visible="false" llaveForanea="false"/>
                                    <campo name="id_activo_fijo" calc="%per.per.letras%+%per.per.numeros%" visible="false"/>
                                    <campo name="clave_almacen"   text="Almacén" descripcionForanea="clave_alamcen" columnas="2" margen-izquierdo="3"/>
                                    <campo name="fecha_elaboracion" text="Fecha" calc="@fechaSistema(&quot;YYYY/MM/dd HH:mm:ss&quot;)" columnas="2" margen-derecho="3"/>
                                    <campo name="justificacion" text="Justificación" columnas="2" margen-izquierdo="3"/>
                                </tabla>
                                <acciones>
                            <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                    </acciones>
                    <estilos>
                        <boton nombre="grabar" posicion="derecha" visible="true" texto="avanzar a nivel" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                    </estilos>
                            </componente>
                        </nivel>
                        <nivel id="datb" nombre="Modifica Traspasos de Patrimonio" ejecutar="%per.per.tipo_movimiento%=='Traspasos'" interactivo="false">
                        <componente id="datb" nombre="Detalle de Artículos de Traspaso" tipo="cursor">
                                <tabla schema="operation" nombre="almacenes">
                                    <campo name="ur" text="ur" columna-visible="false" filtroCampo="ur" filtroOperador="=" filtroValor="%per.per.id_unidad_responsable%"/>
                                    <campo name="id_periodo" text="id_periodo" columna-visible="false" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%per.per.id_periodo%"/>
                                    <campo name="id_almacenes" text="id_almacenes"/>
                                    <campo name="seleccion" text="Selección" filtroCampo="seleccion" filtroOperador="=" filtroValor="true"/>
                                    <campo name="folio_af" text="folio_af" filtroCampo="folio_af" filtroOperador="=" filtroValor="'0'"/>
                                </tabla>
                                     <nivel id="datf" nombre="Modifica Traspasos de Patrimonio" ejecutar="%per.per.tipo_movimiento%=='Traspasos'" interactivo="false">
                                        <componente id="datf" nombre="Detalle de Artículos de Traspaso" tipo="cursor">
                                                <tabla schema="operation" nombre="almacenes">
                                                    <campo name="ur" text="ur" columna-visible="false" filtroCampo="ur" filtroOperador="=" filtroValor="%per.per.id_unidad_responsable%"/>
                                                    <campo name="id_periodo" text="id_periodo" columna-visible="false" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%per.per.id_periodo%"/>
                                                    <campo name="id_almacenes" text="id_almacenes" filtroCampo="id_almacenes" filtroOperador="=" filtroValor="%datb.datb.id_almacenes%"/>
                                                    <campo name="seleccion" text="Selección" filtroCampo="seleccion" filtroOperador="=" filtroValor="true"/>
                                                    <campo name="folio_af" text="folio_af" calc="$inParam.id_activo_fijo$"/>
                                                </tabla>
                                        </componente>
                                    </nivel> 
                            </componente>
                        </nivel>  
        <nivel nombre="Modificacion del patrimonio" id="gsmp" interactivo="false" ejecutar="%re.re.tipo_movimiento%==3">
            <componente tipo="solicitud" nombre="Modificacion del patrimonioo" id="gsmp">
                <parametros url="$config.request$" metodo="POST" accion="crearNuevaInstancia" tipo="json">
                    <parametro name="enterprise" calc="'MAGNITUS'"/>
                    <parametro name="process" calc="'4232ed49-6f50-461b-858e-cfa72932c2af'"/>
                    <parametro name="out_ur" calc="$config.ur$" mostrarEsc="true"/>
                    <parametro name="out_periodo" calc="%per.per.id_periodo%" mostrarEsc="true"/>
                    <parametro name="out_id_activo_fijo" calc="%re.re.id_activo_fijo%" mostrarEsc="true"/>
                    <parametro name="out_tipo_movimiento" calc="%re.re.tipo_movimiento%" mostrarEsc="true"/>
                    <parametro name="out_transaccion" calc="%re.re.transaccion%" mostrarEsc="true"/>
                    <parametro name="out_justificacion" calc="%re.re.justificacion%" mostrarEsc="true"/>
                </parametros>
            </componente>
        </nivel>
        <nivel nombre="REPORTE TRASPASO DE ALMACÉN DE PATRIMONIO" id="TRAS" mostrarNivelAnterior="false" mostrarProximoNivel="false" ejecutar="%re.re.tipo_movimiento%==3">
                <componente tipo="reporte" nombre="REPORTE TRASPASO DE ALMACÉN DE PATRIMONIO" id="TRAS">
                    <reporte nombre="R_Traspaso_Almacen_Patrim_IJ" id="compras" update="true" nombreDocumento="'REPORTE TRASPASO DE ALMACÉN DE PATRIMONIO'" expediente="Solicitudes de Modificación al Patrimonio"  grupo="%re.re.id_activo_fijo%" url="$config.repository_upload_file$"><!--expediente="" nombreDocumento="" grupo="" url="$config.repository_upload_file$"-->
                        <campo name="ur" type="long" calc="%per.per.id_unidad_responsable%"/>
                        <campo name="periodo" type="long" calc="%per.per.id_periodo%"/>
                        <campo name="id_activo_fijo" type="string" calc="%re.re.id_activo_fijo%"/>
                        <campo name="usuario" type="string" calc="%barreUsuarios.barreUsuarios.nombre_usuario%"/>
                    </reporte>
                </componente>
            </nivel>   
         <!--TRASPASO --> 
    </pagina>
</tarea>
