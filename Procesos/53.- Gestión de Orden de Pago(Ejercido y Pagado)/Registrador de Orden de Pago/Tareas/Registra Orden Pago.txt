<tarea id="registraOrdenPago" nombre="Gestión Ordén de Pago">
    <pagina id="1">
        <!-- CURSORES -->
        <!-- USUARIO -->
        <nivel id="barreUsuarios" nombre="barreUsuarios" interactivo="false">
            <componente id="barreUsuarios" nombre="barreUsuarios" tipo="cursor">
                <tabla schema="entity" nombre="usuario">
                    <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$config.ur$"/>
                    <campo name="id_usuario"/>
                    <campo name="nombre_usuario" filtroCampo="nombre_usuario" filtroOperador="=" filtroValor="$protocolarios.user$"/>
                </tabla>
            </componente>
        </nivel>
        <!-- PERIODO -->
        <nivel id="BP" nombre="Busca Periodo" interactivo="false">
            <componente id="BP" nombre="Busca Periodo" tipo="cursor">
                <tabla schema="catalog" nombre="periodo">
                    <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$config.ur$"/>
                    <campo name="id_periodo"/>
                    <campo name="estatus" filtroCampo="estatus" filtroOperador="=" filtroValor="true"/>
                    <campo name="id_estatus" filtroCampo="id_estatus" filtroOperador="=" filtroValor="3"/>
                </tabla>
            </componente>
        </nivel>
        
        <nivel id="inParams" nombre="Parametros" interactivo="false">
            <componente id="inParams" nombre="Parametros" tipo="cursor">
                <tabla schema="catalog" nombre="dummy">
                    <campo name="id" filtroCampo="id" filtroOperador="=" filtroValor="1"/>
                    <campo name="ur" local="true" type="long" calc="%BP.BP.id_unidad_responsable%" />
                    <campo name="periodo" local="true" type="long" calc="%BP.BP.id_periodo%"/>
                </tabla>
            </componente>
        </nivel>
        

        <!-- Reestablecer Seleccion Del Duep -->
        <nivel id="cambiaAFalso" nombre="cambiaAFalso" interactivo="false">
            <componente id="cambiaAFalso" nombre="cambiaAFalso" tipo="cursor">
                <tabla schema="operation" nombre="duep">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%inParams.inParams.ur%"/> 
                    <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%inParams.inParams.periodo%"/>
                    <campo name="folio_duep" /> <!-- filtroCampo="folio_duep" filtroOperador="=" filtroValor="null" -->
                    <campo name="folio_orden_pago" filtroCampo="folio_orden_pago" filtroOperador="=" filtroValor="null"/>
                    <campo name="listo_para_pago" filtroCampo="listo_para_pago" filtroOperador="=" filtroValor="true"/>
                    <campo name="autoriza_devengado" filtroCampo="autoriza_devengado" filtroOperador="=" filtroValor="true"/>
                    <campo name="seleccion_orden_pago" calc="false"/>
                    <campo name="total" calc="@consultaDirec('SELECT COALESCE(SUM(total),0) AS suma FROM operation.duep_detalle WHERE ur='+%inParams.inParams.ur%+' AND periodo='+%inParams.inParams.periodo%+' AND folio_duep='+%cambiaAFalso.cambiaAFalso.folio_duep%,'suma','decimal','MAGNITUS')"/>
                </tabla>
            </componente>
        </nivel>
    
        
        <!--COMPONENTE TIPO TABLA ORDEN DE REGISTRA-->
        <nivel id="registraOrdenPago" nombre="Gestión Ordén de Pago" mostrarProximoNivel="false" mostrarNivelAnterior="false">
            <componente id="etiquetaCD" nombre="Instrucciones" tipo="formulario" accionDefault="seleccionar">
                <tabla schema="catalog" nombre="dummy">
                    <campo name="id" visible="false" text="ID" calc="1" />
                    <etiqueta nombre="accionCD1" texto="PARA SELECCIONAR, DE DOBLE CLIC Y UN TERCERO FUERA DEL RECUADRO DE SELECCIÓN" color="black" bold="normal" tamaño="18px" alineacion="center" interlineado="10px" width="250px" margen-izquierdo="1" columnas="8" margen-derecho="1"/>
                </tabla>
                <estilos>
                    <boton nombre="grabar" texto="Guardar" visible="false" />
                </estilos>
            </componente>
            <componente id="registraOrdenPago" nombre="Documentos Únicos del Ejercicio del Presupuesto" tipo="tabla" mostrarAgregar="false" mostrarEditar="false" mostrarEliminar="false" filtro="true">
                <tabla schema="operation" nombre="duep">
                    <campo name="ur" text="ur" columna-visible="false" filtroCampo="ur" filtroOperador="=" filtroValor="%inParams.inParams.ur%"/>
                    <campo name="periodo" text="periodo" columna-visible="false" filtroCampo="periodo" filtroOperador="=" filtroValor="%inParams.inParams.periodo%"/>
                    <campo name="folio_duep" text="Duep" width="150" visible="false" columna-visible="false" />
                    <campo name="folio_duep_a" text="Folio Duep" filtroCampo="folio_duep_a" filtroOperador="!=" filtroValor="null" columna-visible="true"  width="110"/>
                    <campo name="beneficiario" text="Beneficiario" descripcionForaneaTabla="folio_beneficiario,razon_social" width="280"/>
                    <campo name="fecha_solicitud" text="Fecha"/>
                    <campo name="concepto" text="Concepto"/>
                    <campo name="total" text="Importe" cellsalign="right" formatoMoneda="true" width="120"/> <!-- filtroCampo="total" filtroOperador="!=" filtroValor="null" -->
                    <campo name="id_cat_fondo_contable" text="Fondo" llaveForanea="false" columna-visible="false"/>
                    <campo name="id_fondo_contable" text="Fondo" descripcionForaneaTabla="id_cat,descripcion"/>
                    <campo name="folio_orden_pago" text="folio" filtroCampo="folio_orden_pago" filtroOperador="=" filtroValor="null" visible="false" columna-visible="false"/>
     
                    <campo name="seleccion_orden_pago" text="Selección" editable="true" filtroCampo="seleccion_orden_pago" filtroOperador="=" filtroValor="false" width="80"/> <!-- filtroCampo="seleccion_orden_pago" filtroOperado="!=" filtroValor="true"-->
                    <!--<campo name="folio_operacion_instancia" text="Folio Operacion" calcCliente="@ifThenElse(%seleccion_orden_pago%==true,%folioIns.folioIns.folio_operacion%,null)"/>-->
                    <campo name="listo_para_pago" text="Listo para Pago" columna-visible="false" filtroCampo="listo_para_pago" filtroOperador="=" filtroValor="true"/>
                    <campo name="autoriza_devengado" filtroCampo="autoriza_devengado" filtroOperador="=" filtroValor="true" columna-visible="false" visible="false"/>
                    <campo name="tramite" filtroCampo="tramite" filtroOperador="!=" filtroValor="3" columna-visible="false" visible="false"/>
                </tabla>
                <acciones>
                        <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
                <estilos>
                    <boton nombre="grabar" posicion="derecha" visible="true" texto="Continuar" />
                </estilos>
            </componente>
            
           <!--<validaciones>
                    <validacion tipo="avanzar" validacion="@consultaDirec('select  count(distinct(beneficiario)) &gt; 1 as resultado from operation.duep where seleccion_orden_pago=true and foio_orden_pago is null','resultado','bool','MAGNITUS')" validacionMensaje="'Los registros Deben de Ser del Mismo Beneficiario'"/>
                    <validacion tipo="avanzar" validacion="@consultaDirec('select  count(distinct(id_fondo_contable)) &gt; 1 as resultado_uno from operation.duep where seleccion_orden_pago=true and foio_orden_pago is null','resultado_uno','bool','MAGNITUS')" validacionMensaje="'Los registros deben de ser del mismo Fondo Contable'"/>
            </validaciones>-->
        </nivel>
        <!-- GENERACIÓN DEL FOLIO DE OPERACIÓN DE LA INSTANCIA -->
        <nivel id="folioIns" nombre="Genera Folio Operación Instancia" interactivo="false">
            <componente id="folioIns" nombre="Genera Folio Operación Instancia" tipo="altaDirect">
                <tabla schema="catalog" nombre="folio_operacion_duep">
                    <campo name="ur" calc="%inParams.inParams.ur%"/>
                    <campo name="periodo" calc="%inParams.inParams.periodo%"/>
                    <campo name="folio_operacion" generacion="@prox()+1" autogenerado="true"/>
                    <campo name="fecha_registro" calc="@fechaSistema()"/>
                </tabla>
            </componente>
        </nivel>
        
         <!-- INSERTA EL FOLIO DE OPERACIÓN DE LA INSTANCIA DE LOS DUEPS SELECCIONADOS -->
        <nivel id="actualizaFolioInstancia" nombre="barreDUEPSeleccionable_DUEP" interactivo="false">
            <componente id="actualizaFolioInstancia" nombre="barreDUEPSeleccionable_DUEP" tipo="cursor">
                <tabla schema="operation" nombre="duep">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%inParams.inParams.ur%"/>
                    <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%inParams.inParams.periodo%"/>
                    <campo name="seleccion_orden_pago" filtroCampo="seleccion_orden_pago" filtroOperador="=" filtroValor="true"/>
                    <campo name="folio_orden_pago" filtroCampo="folio_orden_pago" filtroOperador="=" filtroValor="null"/>
                    <campo name="folio_operacion_instancia" calc="%folioIns.folioIns.folio_operacion%"/>
                </tabla>
            </componente>
        </nivel>
       
        <nivel id="barreDUEPSeleccionable_DUEP" nombre="barreDUEPSeleccionable_DUEP" interactivo="false">
            <componente id="barreDUEPSeleccionable_DUEP" nombre="barreDUEPSeleccionable_DUEP" tipo="cursor">
                <tabla schema="operation" nombre="duep">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%inParams.inParams.ur%"/>
                    <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%inParams.inParams.periodo%"/>
                    <campo name="folio_operacion_instancia" filtroCampo="folio_operacion_instancia" filtroOperador="=" filtroValor="%folioIns.folioIns.folio_operacion%"/>
                    <campo name="seleccion_orden_pago" filtroCampo="seleccion_orden_pago" filtroOperador="=" filtroValor="true"/>
                    <campo name="folio_duep"/><!--aqui-->
                    <campo name="folio_duep_a"/>
                    <campo name="beneficiario"/>
                    <campo name="fecha_solicitud"/>
                    <campo name="concepto"/>
                    <campo name="total"/>
                    <campo name="id_cat_fondo_contable"/>
                    <campo name="id_fondo_contable"/>
                    <campo name="muchos_dueps" local="true" type="string" text="Otra" cellsalign="left" width="200" calc="
                    @ifThenElse(%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.concepto% == null OR %barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.folio_duep_a%==null, ' ', @concatenar('CLC-'+%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.folio_duep_a%) + ',' + ' ')"/>
                    <campo name="folio_expediente"/>
                </tabla>
            </componente>
        </nivel>
        
        <nivel id="altaOrdenPago" nombre="altaOrdenPago" interactivo="false">
            <componente id="altaOrdenPago" nombre="altaOrdenPago" tipo="altaDirect">
                <tabla schema="operation" nombre="orden_pago">
                    <campo name="ur" calc="%inParams.inParams.ur%"/>
                    <campo name="id_periodo" calc="%inParams.inParams.periodo%"/>
                    <campo name="orden_pago" generacion="@prox()+1" autogenerado="true"/>
                    <campo name="fecha_registro" calc="@fechaSistema()"/> 
                    <campo name="id_cat_fondo_contable" calc="%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.id_cat_fondo_contable%"/>
                    <campo name="id_fondo_contable" calc="%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.id_fondo_contable%"/>
                    <campo name="beneficiario" calc="%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.beneficiario%"/>
                    <campo name="concepto" calc="%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.muchos_dueps%"/>
                    <campo name="estatus_orden_pago" calc="1"/>
                    <campo name="folio_duep" calc="%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.folio_duep%"/>
                    <campo name="ultimo_usuario_modificador" calc="%barreUsuarios.barreUsuarios.id_usuario%"/>
                    <campo/>
                </tabla>
            </componente>
        </nivel>
                
        <nivel id="altaOrdenPagoFolio" nombre="altaOrdenPagoFolio" interactivo="false">
            <componente id="altaOrdenPagoFolio" nombre="altaOrdenPagoFolio" tipo="cursor">
                <tabla schema="operation" nombre="orden_pago">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.ur%"/>
                    <campo name="id_periodo" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.id_periodo%"/>
                    <campo name="orden_pago" filtroCampo="orden_pago" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.orden_pago%"/>
                    <campo name="folio_orden_pago" 
                        calc="@concatenar('CLC-'+@ifThenElse(%altaOrdenPago.altaOrdenPago.orden_pago% &lt;
                                    10,'00000',@ifThenElse(%altaOrdenPago.altaOrdenPago.orden_pago% &lt; 
                                    100,'0000',@ifThenElse(%altaOrdenPago.altaOrdenPago.orden_pago% &lt; 
                                    1000,'000',@ifThenElse(%altaOrdenPago.altaOrdenPago.orden_pago% &lt; 
                                    10000,'00',@ifThenElse(%altaOrdenPago.altaOrdenPago.orden_pago% &lt; 
                                    100000,'0',null)))))+%altaOrdenPago.altaOrdenPago.orden_pago%)"/>
                </tabla>
            </componente>
        </nivel>
        
        
        <!--AQUI-->
        <nivel id="barreDUEPSeleccionable" nombre="barreDUEPSeleccionable" interactivo="false">
            <componente id="barreDUEPSeleccionable" nombre="barreDUEPSeleccionable" tipo="cursor">
                <tabla schema="operation" nombre="duep">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%inParams.inParams.ur%"/>
                    <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%inParams.inParams.periodo%"/>
                    <campo name="folio_operacion_instancia" filtroCampo="folio_operacion_instancia" filtroOperador="=" filtroValor="%folioIns.folioIns.folio_operacion%"/>
                    <campo name="seleccion_orden_pago" filtroCampo="seleccion_orden_pago" filtroOperador="=" filtroValor="true"/>
                    <campo name="folio_duep"/>
                    <campo name="folio_duep_a"/>
                    <campo name="beneficiario"/>
                    <campo name="fecha_solicitud"/>
                    <campo name="concepto"/>
                    <campo name="total"/>
                    <campo name="id_cat_fondo_contable"/>
                    <campo name="id_fondo_contable"/>
                    <!-- Campo de Folio con condicion de seleccion orden de pago y si tiene valor-->
                    <campo name="id_cat_fuente_financiamiento"/>
                    <campo name="id_fuente_financiamiento"/>
                    <campo name="folio_orden_pago" calc="%altaOrdenPago.altaOrdenPago.orden_pago%"/>
                    <campo name="tramite"/>
                </tabla>
                
                <nivel id="duepDetalle" nombre="duepDetalle" interactivo="false" >
                    <componente id="duepDetalle" nombre="duepDetalle" tipo="cursor">
                        <tabla schema="operation" nombre="duep_detalle">
                            <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%barreDUEPSeleccionable.barreDUEPSeleccionable.ur%"/>
                            <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%barreDUEPSeleccionable.barreDUEPSeleccionable.periodo%"/>
                            <campo name="folio_duep" filtroCampo="folio_duep" filtroOperador="=" filtroValor="%barreDUEPSeleccionable.barreDUEPSeleccionable.folio_duep%" />
                            <campo name="folio_duep_detalle"/>
                            <campo name="tipo_detalle"  /><!-- filtroCampo="tipo_detalle" filtroOperador="=" filtroValor="1 || 3"-->
                            <campo name="id_cat_fuente"/>
                            <campo name="fuente_financiamiento"/>
                            <campo name="clave_presupuestal"/>
                            <campo name="mes_cve_presupuestal"/>
                            <campo name="descripcion_especifica"/>
                            <campo name="u_medida"/>
                            <campo name="cantidad"/>
                            <campo name="importe"/>
                            <campo name="precio_unitario"/>
                            <campo name="total"/>
                            <campo name="folio_orden_pago" calc="%altaOrdenPago.altaOrdenPago.orden_pago%"/>
                        </tabla>
                        <nivel id="altaDetalleDUEP" nombre="altaDetalleDUEP" interactivo="false" >
                            <componente id="altaDetalleDUEP" nombre="altaDetalleDUEP" tipo="altaDirect">
                                <tabla schema="operation" nombre="orden_pago_detalle">
                                    <campo name="ur" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.ur%"/>
                                    <campo name="id_periodo" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.periodo%"/>
                                    <campo name="orden_pago" calc="%altaOrdenPago.altaOrdenPago.orden_pago%"/>
                                    <campo name="id_detalle_orden_pago" generacion="@prox()+1" autogenerado="true"/>
                                    <campo name="folio_duep" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.folio_duep%"/>
                                    <campo name="folio_duep_detalle" calc="%duepDetalle.duepDetalle.folio_duep_detalle%"/>
                                    <campo name="folio_duep_a" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.folio_duep_a%"/>
                                    <campo name="fecha_registro" calc="@fechaSistema()"/>
                                    <campo name="concepto" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.concepto%"/>
                                    <campo name="id_cat_fuente_financiamiento" calc="%duepDetalle.duepDetalle.id_cat_fuente%"/>
                                    <campo name="id_fuente_financiamiento" calc="%duepDetalle.duepDetalle.fuente_financiamiento%"/>
                                    <campo name="descripcion_especifica" calc="%duepDetalle.duepDetalle.descripcion_especifica%"/>
                                    <campo name="u_medida" calc="%duepDetalle.duepDetalle.u_medida%"/>
                                    <campo name="cantidad" calc="@ifThenElse(%duepDetalle.duepDetalle.cantidad%==null,1,@castTo(%duepDetalle.duepDetalle.cantidad%,'long'))"/>
                                    <campo name="clave_presupuestal" calc="%duepDetalle.duepDetalle.clave_presupuestal%"/>
                                    <campo name="cve_mes_pre" calc="%duepDetalle.duepDetalle.mes_cve_presupuestal%"/>
                                    <campo name="total" calc="%duepDetalle.duepDetalle.total%"/>
                                    <campo name="total_estimado" calc="%duepDetalle.duepDetalle.total%"/>
                                    <campo name="precio_unitario" calc="%duepDetalle.duepDetalle.precio_unitario%"/>
                                    <campo name="importe" calc="%duepDetalle.duepDetalle.importe%"/>
                                    <campo name="importe_letra" calc="@numeroAletra(%duepDetalle.duepDetalle.importe%,'PESOS M.N.')"/>
                                    <campo name="ultimo_usuario_modificador" calc="%barreUsuarios.barreUsuarios.id_usuario%"/>
                                </tabla>
                            </componente>
                         </nivel>
                         <!-- PARA TRAMITE DE GESTIÓN DE ANTICIPOS ANTICIPOS TRAMITE==9 -->
                         <nivel id="altaDetalleDUEP2" nombre="altaDetalleDUEP" interactivo="false" ejecutar="%duepDetalle.duepDetalle.tipo_detalle%==2 AND %barreDUEPSeleccionable.barreDUEPSeleccionable.tramite%==9">
                            <componente id="altaDetalleDUEP2" nombre="altaDetalleDUEP" tipo="altaDirect">
                                <tabla schema="operation" nombre="orden_pago_detalle">
                                    <campo name="ur" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.ur%"/>
                                    <campo name="id_periodo" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.periodo%"/>
                                    <campo name="orden_pago" calc="%altaOrdenPago.altaOrdenPago.orden_pago%"/>
                                    <campo name="id_detalle_orden_pago" generacion="@prox()+1" autogenerado="true"/>
                                    <campo name="folio_duep" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.folio_duep%"/>
                                    <campo name="folio_duep_detalle" calc="%duepDetalle.duepDetalle.folio_duep_detalle%"/>
                                    <campo name="folio_duep_a" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.folio_duep_a%"/>
                                    <campo name="fecha_registro" calc="@fechaSistema()"/>
                                    <campo name="concepto" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.concepto%"/>
                                    <campo name="id_cat_fuente_financiamiento" calc="%duepDetalle.duepDetalle.id_cat_fuente%"/>
                                    <campo name="id_fuente_financiamiento" calc="%duepDetalle.duepDetalle.fuente_financiamiento%"/>
                                    <campo name="descripcion_especifica" calc="%duepDetalle.duepDetalle.descripcion_especifica%"/>
                                    <campo name="u_medida" calc="%duepDetalle.duepDetalle.u_medida%"/>
                                    <campo name="cantidad" calc="@ifThenElse(%duepDetalle.duepDetalle.cantidad%==null,1,@castTo(%duepDetalle.duepDetalle.cantidad%,'long'))"/>
                                    <campo name="clave_presupuestal" calc="%duepDetalle.duepDetalle.clave_presupuestal%"/>
                                    <campo name="cve_mes_pre" calc="%duepDetalle.duepDetalle.mes_cve_presupuestal%"/>
                                    <campo name="total" calc="%duepDetalle.duepDetalle.total%"/>
                                    <campo name="total_estimado" calc="%duepDetalle.duepDetalle.total%"/>
                                    <campo name="precio_unitario" calc="%duepDetalle.duepDetalle.precio_unitario%"/>
                                    <campo name="importe" calc="%duepDetalle.duepDetalle.importe%"/>
                                    <campo name="importe_letra" calc="@numeroAletra(%duepDetalle.duepDetalle.importe%,'PESOS M.N.')"/>
                                    <campo name="ultimo_usuario_modificador" calc="%barreUsuarios.barreUsuarios.id_usuario%"/>
                                </tabla>
                            </componente>
                         </nivel>
                         
                    </componente>
                </nivel>
            </componente>
        </nivel>
        
        <nivel id="sumaImporteOrdenPago" nombre="sumaImporteOrdenPago" interactivo="false">
            <componente id="sumaImporteOrdenPago" nombre="sumaImporteOrdenPago" tipo="cursor">
                <tabla schema="operation" nombre="orden_pago">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.ur%"/>
                    <campo name="id_periodo" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.id_periodo%"/>
                    <campo name="orden_pago" filtroCampo="orden_pago" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.orden_pago%"/>
                    <campo name="importe_total" calc="@consultaDirec('SELECT COALESCE(SUM(total),0) AS importe_total FROM operation.orden_pago_detalle WHERE ur='+%altaOrdenPago.altaOrdenPago.ur%+' AND id_periodo='+%altaOrdenPago.altaOrdenPago.id_periodo%+' AND orden_pago='+%altaOrdenPago.altaOrdenPago.orden_pago%+'','importe_total','decimal','MAGNITUS')"/>
                </tabla>
            </componente>
        </nivel>
        
        <nivel id="ImporteALetraOrdenPago" nombre="Importe A Letra de Orden de Pago" interactivo="false">
            <componente id="ImporteALetraOrdenPago" nombre="Importe A Letra Orden de Pago" tipo="cursor">
                <tabla schema="operation" nombre="orden_pago">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.ur%"/>
                    <campo name="id_periodo" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.id_periodo%"/>
                    <campo name="orden_pago" filtroCampo="orden_pago" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.orden_pago%"/>
                    <campo name="total_letra" calc="@numeroAletra(%sumaImporteOrdenPago.sumaImporteOrdenPago.importe_total%,'PESOS M.N.')"/>
                </tabla>
            </componente>
        </nivel>
        
        
        
        
        <!-- Actualiza a False la seleccion -->
        
        <!-- Actualiza Concepto-->
        <nivel id="barreDUEPSeleccionableC" nombre="barreDUEPSeleccionableC" interactivo="false">
            <componente id="barreDUEPSeleccionableC" nombre="barreDUEPSeleccionableC" tipo="cursor">
                <tabla schema="operation" nombre="duep">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%inParams.inParams.ur%"/>
                    <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%inParams.inParams.periodo%"/>
                    <campo name="folio_duep"/>
                    <campo name="folio_duep_a"/>
                    <campo name="beneficiario"/>
                    <campo name="fecha_solicitud"/>
                    <campo name="concepto"/>
                    <campo name="total"/>
                    <campo name="id_cat_fondo_contable"/>
                    <campo name="id_fondo_contable"/>
                    <!-- Campo de Folio con condicion de seleccion orden de pago y si tiene valor-->
                    <campo name="seleccion_orden_pago" filtroCampo="seleccion_orden_pago" filtroOperador="=" filtroValor="true"/>
                    <campo name="folio_operacion_instancia" filtroCampo="folio_operacion_instancia" filtroOperador="=" filtroValor="%folioIns.folioIns.folio_operacion%" />
                    <campo name="id_cat_fuente_financiamiento"/>
                    <campo name="id_fuente_financiamiento"/>
                    <campo name="folio_orden_pago" calc="%altaOrdenPago.altaOrdenPago.orden_pago%"/>
                </tabla>
                <nivel id="altaOrdenPagoC" nombre="altaOrdenPagoC" interactivo="false">
                    <componente id="altaOrdenPagoC" nombre="altaOrdenPagoC" tipo="cursor">
                        <tabla schema="operation" nombre="orden_pago">
                            <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%inParams.inParams.ur%"/>
                            <campo name="id_periodo" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%inParams.inParams.periodo%"/>
                            <campo name="orden_pago" filtroCampo="orden_pago" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.orden_pago%"/>
                            <campo name="concepto" calc="@ifThenElse(%barreDUEPSeleccionableC.barreDUEPSeleccionableC.folio_duep_a%==null,' ',@concatenar('CLC-'+%barreDUEPSeleccionableC.barreDUEPSeleccionableC.folio_duep_a%)+',')+@concatenar('CLC-'+%barreDUEPSeleccionableC.barreDUEPSeleccionableC.folio_duep_a%)"/>
                        </tabla>
                    </componente>
                </nivel>
            </componente>
        </nivel>
        
        
        <!-- REESTABLECER SELECCION DE DUEPS -->
        <nivel id="FSDS" nombre="Filtrar Selección de DUEPS" interactivo="false">
            <componente id="FSDS" nombre="Filtrar Selección de DUEPS" tipo="cursor">
                <tabla schema="operation" nombre="duep">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%inParams.inParams.ur%"/>
                    <campo name="periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%inParams.inParams.periodo%"/>
                    <campo name="folio_operacion_instancia" filtroCampo="folio_operacion_instancia" filtroOperador="=" filtroValor="%folioIns.folioIns.folio_operacion%" />
                    <campo name="seleccion_orden_pago" calc="false"/>
                    <campo name="tramite"/>
                </tabla>
            </componente>
        </nivel>
        
        <nivel id="DE" nombre="Determinar Expediente"  interactivo="false">
		    <componente id="DE" nombre="Determinar Expediente" tipo="cursor">
		        <tabla schema="catalog" nombre="dummy">
		            <campo name="id" filtroCampo="id" filtroOperador="=" filtroValor="1"/>
		            <campo name="expediente_tramite" local="true" type="string" 
		            calc="@ifThenElse(%FSDS.FSDS.tramite%==2 OR %FSDS.FSDS.tramite%==3,'Expediente de Compras Menores/Orden de Pago',
		                  @ifThenElse(%FSDS.FSDS.tramite%==8 OR %FSDS.FSDS.tramite%==9,'Expediente Adquisiciones/Orden de Pago',
		                  @ifThenElse(%FSDS.FSDS.tramite%==11,'Expediente Compromiso Candelarizado/Orden de Pago',
		                  'Expediente Adquisiciones/Orden de Pago')))"/>
		        </tabla>
		    </componente>
		</nivel>
        
        
        
        
        <!-- FILTRAR BENEFICIARIO DE ORDEN DE PAGO -->
        <nivel id="FBOP" nombre="Filtrar Beneficiario de OP" interactivo="false">
            <componente id="FBOP" nombre="Filtrar Beneficiario de OP" tipo="cursor">
                <tabla schema="operation" nombre="orden_pago">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="%inParams.inParams.ur%"/>
                    <campo name="id_periodo" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%inParams.inParams.periodo%"/>
                    <campo name="orden_pago" filtroCampo="orden_pago" filtroOperador="=" filtroValor="%altaOrdenPago.altaOrdenPago.orden_pago%"/>
                    <campo name="beneficiario"/>
                </tabla>
            </componente>
        </nivel>
        
        
        <!-- CUENTA BANCARIA DE BENEFICIARIO --> 
        <nivel id="FCBB" nombre="Filtra Cuenta Bancaria de Beneficiario" interactivo="false">
            <componente id="FCBB" nombre="Filtra Cuenta Bancaria de Beneficiario" tipo="cursor">
                <tabla schema="entity" nombre="beneficiario_cuenta_bancaria">
                    <campo name="id_beneficiario" filtroCampo="id_beneficiario" filtroOperador="=" filtroValor="%FBOP.FBOP.id_beneficiario%"/>
                    <campo name="cuenta_bancaria"/>
                    <campo name="id_banco"/> 
                    <campo name="clabe"/>
                    <campo name="estatus"/>
                </tabla>
            </componente>
        </nivel>
        <!-- BANCO -->
        <nivel id="BB" nombre="Banco de Beneficiario" interactivo="false">
            <componente id="BB" nombre="Banco de Beneficiario" tipo="cursor">
                <tabla schema="catalog" nombre="banco">
                    <campo name="id_banco" filtroCampo="id_banco" filtroOperador="=" filtroValor="%FCBB.FCBB.id_banco%"/> 
                   <campo name="id_unidad_responsable"/>
                   <campo name="nombre"/>
                </tabla>
            </componente>
        </nivel>
        
        
        
        
        <!-- Fin Actualiza Concepto-->
       <!--INICIO DEL MAESTRO DETALLE-->
        <nivel id="maestroDetalleOrdenPago" nombre="Gestión Ordén de Pago" mostrarNivelAnterior="false" mostrarProximoNivel="false">
            <componente id="maestroDetalleOrdenPago" nombre="Registra Orden de Pago" tipo="maestroDetalle">
                <encabezado accionDefault="editar">
                    <tabla schema="operation" nombre="orden_pago">
                        <campo name="ur" text="Unidad Responsable" calc="%altaOrdenPago.altaOrdenPago.ur%" visible="false"/>
                        <campo name="id_periodo" text="Periodo" calc="%altaOrdenPago.altaOrdenPago.id_periodo%" visible="false"/>
                        <campo name="orden_pago" text="Folio Orden de Pago" calc="%altaOrdenPago.altaOrdenPago.orden_pago%" visible="false"/>
                        <campo name="folio_orden_pago" text="Folio Orden de Pago" habilitado="false" columnas="2" margen-izquierdo="1"/>
                        <campo name="beneficiario" text="Beneficiario" descripcionForanea="folio_beneficiario,razon_social" habilitado="false" columnas="2" margen-izquierdo="1"/>
                        <campo name="id_cat_fondo_contable" text="ID FC" visible="false" llaveForanea="false"/>
                        <campo name="id_fondo_contable" text="Fondo Contable" descripcionForanea="id_cat,descripcion" visible="true" habilitado="false" columnas="2" margen-izquierdo="1"/>
                        <campo name="fecha_registro" text="Fecha de Emisión" calc="@fechaSistema()"  columnas="2" margen-izquierdo="1"/>
                        <campo name="fecha_programacion_pago" text="Fecha de Programación de Pago" calc="@sumaFecha(%maestroDetalleOrdenPago.maestroDetalleOrdenPago.fecha_registro%,5,'d')" columnas="2" margen-izquierdo="1" habilitado="true"/>
                    
                         <!--
                        <campo name="cuenta_bancaria_beneficiario" text="Para depósito en:" 
                        calc="@ifThenElse(%beneficiario%!=null,@consultaDirec('select cuenta_bancaria as resultado from entity.beneficiario_cuenta_bancaria where id_beneficiario='+'\\''+%beneficiario%+'\\'','resultado','string','MAGNITUS'),null)" 
                        descripcionForanea="cuenta_bancaria"  columnas="3" margen-derecho="2" visible="false" llaveForanea="false"/>
                        <campo name="cuenta_bancaria_beneficiario_local" local="true" type="string" text="Para depósito en:" 
                        calc="@ifThenElse(%beneficiario%!=null,@concatenar(@consultaDirec('select cuenta_bancaria as resultado from entity.beneficiario_cuenta_bancaria where id_beneficiario='+'\\''+%beneficiario%+'\\'','resultado','string','MAGNITUS')+'-'+@consultaDirec('select clabe as resultado from entity.beneficiario_cuenta_bancaria where id_beneficiario='+'\\''+%beneficiario%+'\\'','resultado','string','MAGNITUS')),null)" 
                        descripcionForanea="cuenta_bancaria"  columnas="3" margen-derecho="2" visible="true" habilitado="false"/>-->
                        <campo name="cuenta_bancaria_beneficiario_lo" text="Para depósito en:" 
                        calc="%BB.BB.nombre%+ ' ' + %FCBB.FCBB.cuenta_bancaria% + ' ' + %FCBB.FCBB.clabe%" local="true" type="string" columnas="2" margen-izquierdo="1" visible="true"/>
                        <campo name="para_deposito" text="para deposito" visible="false" calc="%cuenta_bancaria_beneficiario_lo%"/>
                        <campo name="concepto" text="Concepto" columnas="6" llaveForanea="false" habilitado="false" margen-izquierdo="2" margen-derecho="2" width="750" height="50"/>
                        <campo name="poliza" text="Poliza" visible="false"/>
                        <campo name="estatus_orden_pago" text="estatus_orde_pago" visible="false"/>
                        <campo name="ultimo_usuario_modificador" visible="false"/>
                        <campo name="forma_pago" text="Forma de Pago" visible="false"/>
                        <campo name="observaciones" text="Observaciones" visible="true" columnas="6" height="150"  margen-izquierdo="2"/>
                        <!--<campo name="importe_total" calc="%barreImporteDetalle.barreImporteDetalle.acumulado%" visible="true" columnas="6" height="150"  margen-derecho="2"/>-->
                        <!--<campo name="importe_total_letra" calc="@numeroAletra(%importe_total%,'','PESOS','M.N.')" visible="true"/>-->
                        
                        
                       <!-- <campo name="folio" text="Folio" local="true" type="long" calc="@consultaDirec('SELECT folio_add AS result FROM operation.proc_add WHERE ur= '+$inParam.ur$+' AND periodo='+$inParam.periodo$+' AND proyecto_compra='+'\\''+$inParam.id_compras$+'\\''+' and tipo_adjudicacion=1','result','long','MAGNITUS')"/> <campo name="importe_total_letra" calc="@numeroAletra(%importe_total%, '','PESOS','M.N.')"/>-->
                        
                       <!-- <campo name="importe_total" text="Importe Total" visible="true" calcCliente="@consultaDirec('select sum(importe) as result from operation.orden_pago_detalle where ur='+%altaOrdenPago.altaOrdenPago.ur%+' and id_periodo='+%altaOrdenPago.altaOrdenPago.id_periodo%+' and orden_pago='+%altaOrdenPago.altaOrdenPago.orden_pago%+'','result','decimal','MAGNITUS')"/>-->
                        <!--<campo name="importe_total_letra" calc="@numeroAletra(@castTo(%importe_total%,'float'), '','PESOS','M.N.')" visible="false"/>-->
                      
                    </tabla>
                    <estilos>
                        <boton nombre="grabar" visible="true" texto="Guardar"/>
                    </estilos>
                    <acciones>
                       <accion nombre="grabar" hacer="saltar siguiente componente"/>
                    </acciones>
                </encabezado>
                <detalles> <!--  -->
                    <tabla id="identificador_detalle" schema="operation" nombre="orden_pago_detalle" tituloDetalle="No. Renglón" mostrarEliminar="false" mostrarEditar="false" mostrarAgregar="false">
                        <campo name="ur" text="ur" llaveForanea="false" columna-visible="false"/>
                        <campo name="id_periodo" text="periodo" llaveForanea="false" columna-visible="false"/>
                        <campo name="orden_pago" llaveForanea="false" text="Orden de Pago" columna-visible="false"/>
                        <campo name="id_detalle_orden_pago" text="No. Renglón" generacion="@prox()+1" autogenerado="true" width="80"/>
                        <campo name="folio_duep" text="Folio" llaveForanea="false"  visible="false" columna-visible="false"/> <!--aqui  barreDUEPSeleccionable.barreDUEPSeleccionable.folio_duep_a-->
                        
                        <campo name="folio_duep_a" text="Folio" width="150" visible="true"/> <!-- calc="%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.folio_duep_a%" local="true" type="string"-->
                        
                        
                        <campo name="concepto" text="Concepto"   />
                        <campo name="id_cat_fuente_financiamiento" visible="false" llaveForanea="false" columna-visible="false" text="cat_fuente" width="150"/>
                        <campo name="id_fuente_financiamiento" text="Fuente de Financiamiento" width="300" descripcionForanea="id_cat,descripcion" descripcionForaneaTabla="id_cat,descripcion"/>
                        <!--<campo name="id_catalogo" text="Fuente de Financiamiento" local="true" type="string" 
                        calc="@consultaDirec('SELECT cat.descripcion FROM operation.orden_pago_detalle opd 
                        INNER JOIN operation.duep d ON opd.folio_duep = d.folio_duep
                        INNER JOIN catalog.catalogos cat ON d.id_cat_fuente_financiamiento = cat.id_cat 
                        AND d.id_fuente_financiamiento = cat.id_catalogo
                        WHERE opd.folio_duep ='+'\\''+%barreDUEPSeleccionable.barreDUEPSeleccionable.folio_duep%+'\\'','descripcion','string','MAGNITUS')" />-->
                        <campo name="fecha_registro" text="Fecha de Registro"  llaveForanea="false" width="200"/>
                        <campo name="total" text="Importe total" muestraAcumulado="true"  formatoMoneda="true" width="200" columna-visible="true"/>
                        <campo name="importe" text="Importe" muestraAcumulado="true" formatoMoneda="true" columna-visible="false"/>
                        <campo name="total_importe" text="Importe Total" columna-visible="false" visible="false" calc="%barreDUEPSeleccionable.barreDUEPSeleccionable.total%" local="true" type="string" width="200"  />
                        
                        
                        <campo name="ultimo_usuario_modificador" text="Usuario" columna-visible="false"/>
                    </tabla>
                    <acciones>
                            <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                        </acciones>
                        <estilos>
                            <boton nombre="grabar" posicion="derecha" visible="true" texto="Guardar" />
                        </estilos>
                </detalles>
            </componente>
        </nivel>
        
        
        
        <nivel id="lanzaInstanciaOrdenPago" nombre="lanzaInstanciaOrdenPago" interactivo="false">
            <componente id="lanzaInstanciaOrdenPago" nombre="lanzaInstanciaOrdenPago" tipo="solicitud">
                <parametros url="$config.request$" metodo="POST" accion="crearNuevaInstancia" tipo="json">
                    <parametro name="enterprise" calc="'MAGNITUS'"/>
                    <parametro name="process" calc="'7f6f6183-1238-4b69-ac09-8ae8802f9cda'"/>
                    <parametro name="user" calc="$protocolarios.user$"/>
                    <parametro name="out_ur" calc="%altaOrdenPago.altaOrdenPago.ur%"/>
                    <parametro name="out_periodo" calc="%altaOrdenPago.altaOrdenPago.id_periodo%" mostrarEsc="true"/>
                    <parametro name="out_orden_pago" calc="%altaOrdenPago.altaOrdenPago.orden_pago%" mostrarEsc="true"/>
                    <parametro name="out_folio_orden_pago" calc="%altaOrdenPagoFolio.altaOrdenPagoFolio.folio_orden_pago%" mostrarEsc="true"/>
                    <parametro name="out_fecha_de_emision" calc="%altaOrdenPago.altaOrdenPago.fecha_registro%" mostrarEsc="true"/>
                    <parametro name="out_concepto" calc="%maestroDetalleOrdenPago.maestroDetalleOrdenPago.concepto%" mostrarEsc="true"/>
                    <parametro name="out_folio_operacion" calc="%folioIns.folioIns.folio_operacion%" mostrarEsc="true" />
                    <parametro name="out_expediente" calc="%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.folio_expediente%"/>
                    <parametro name="out_tramite" calc="%FSDS.FSDS.tramite%" mostrarEsc="false"/>
                </parametros>
            </componente>
        </nivel>
        
        <nivel id="reporteOrdenPago" nombre="Formato de Orden de Pago" ejecutar="%FSDS.FSDS.tramite%!=11" mostrarProximoNivel="true" mostrarNivelAnterior="false">
            <componente tipo="reporte" id="reporteOrdenPago" nombre="Formato de Ordén de Pago" >
                <reporte nombre="repor_orden_pago_jsus" id="pago" expediente="%DE.DE.expediente_tramite%" nombreDocumento="'Orden de Pago'" url="$config.repository_upload_file$" grupo="%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.folio_expediente%"> 
                    <campo name="ur" type="long" text="Unidad Responsable"  calc="@castTo(%inParams.inParams.ur%,'long')"/>
                    <campo name="id_periodo" type="long" text="Periodo"  calc="%inParams.inParams.periodo%"/> 
                    <campo name="orden_pago" type="long" text="Orden de Pago"  calc="%maestroDetalleOrdenPago.maestroDetalleOrdenPago.orden_pago% "/>
                    <campo name="usuario" local="true" type="string" calc="@castTo($protocolarios.user$,'string')"/>
                </reporte>
            </componente>
        </nivel>
        
        <nivel id="RCCSP" nombre="Documento Compromisos Calendarizados" ejecutar="%FSDS.FSDS.tramite%==11" mostrarProximoNivel="true" mostrarNivelAnterior="false">
            <componente id="RCCSP" nombre="Formato de Ordén de Pago" tipo="reporte">
                <reporte nombre="r_ordenpago" id="pago" expediente="%DE.DE.expediente_tramite%" nombreDocumento="'Orden de Pago'" url="$config.repository_upload_file$" grupo="%barreDUEPSeleccionable_DUEP.barreDUEPSeleccionable_DUEP.folio_expediente%"> 
                    <campo name="ur" type="long" text="Unidad Responsable"  calc="@castTo(%inParams.inParams.ur%,'long')"/>
                    <campo name="id_periodo" type="long" text="Periodo"  calc="%inParams.inParams.periodo%"/> 
                    <campo name="orden_pago" type="long" text="Orden de Pago"  calc="%maestroDetalleOrdenPago.maestroDetalleOrdenPago.orden_pago% "/>
                    <campo name="usuario" local="true" type="string" calc="@castTo($protocolarios.user$,'string')"/>
                </reporte>
            </componente>
        </nivel>
        
        <nivel nombre="Cierra Tarea" id="CT" interactivo="false">
            <componente tipo="cursor" nombre="Cierra Tarea" id="CT">
                <tabla schema="catalog" nombre="dummy">
                    <campo name="id" filtroCampo="id" filtroOperador="=" filtroValor="1"/>
                </tabla>
            </componente>
        </nivel>
        
    </pagina>
</tarea>