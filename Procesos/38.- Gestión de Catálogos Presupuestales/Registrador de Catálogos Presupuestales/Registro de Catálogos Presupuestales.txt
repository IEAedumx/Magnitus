<tarea id="GestionCatalogoPresupuestal" nombre="Catálogos Presupuestales" version="1" autor="Juan Alberto">
    <pagina id="1" mostrarProximoNivel="false" mostrarNivelAnterior="false">
        <nivel id="nlPeriodoC" nombre="Periodo" interactivo="false">
            <componente tipo="cursor" id="PeriodoC" nombre="Periodo">
                <tabla schema="catalog" nombre="periodo">
                    <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$config.ur$"/>
                    <campo name="id_periodo"/>
                    <campo name="estatus" filtroCampo="estatus" filtroOperador="=" filtroValor="true"/>
                    <campo name="id_estatus" filtroCampo="id_estatus" filtroOperador="=" filtroValor="3"/>
                </tabla>
            </componente>
        </nivel>
        <nivel id="nlUsuariosC" nombre="Usuarios" interactivo="false">
            <componente id="UsuariosC" nombre="Usuarios" tipo="cursor">
                <tabla schema="entity" nombre="usuario">
                    <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$config.ur$"/>
                    <campo name="id_usuario"/>
                    <campo name="nombre_usuario" filtroCampo="nombre_usuario" filtroOperador="=" filtroValor="$protocolarios.user$"/>
                </tabla>
            </componente>
        </nivel>
        <nivel id="nlGestionCatalogoPre" nombre="Catálogos Presupuestales Seleccionar Catálogo" mostrarProximoNivel="false">
            <componente id="cpSeleccionarCatPresupuestal" nombre="Catálogos Presupuestales" tipo="formulario" accionDefault="seleccionar">
                <tabla schema="catalog" nombre="segmento_mascara">
                    <campo name="id_unidad_responsable" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" text="Unidad Responsable" llaveForanea="false" visible="false"/>
                    <campo name="id_periodo" calc="%nlPeriodoC.PeriodoC.id_periodo%" text="Ejercicio Fiscal" llaveForanea="false" visible="true" columnas="3"  margen-izquierdo="2"/>
                      
                    <campo name="id_catalogo" text="Catálogo" visible="true" validacion="%id_catalogo%==null" validacionMensaje="Favor de seleccionar una opción para continuar..." llavesFijas="id_seccion!=5" columnas="4" margen-derecho="1" ordenar="asc" marcador="Seleccione un Catálogo"/> <!-- descripcionForanea="id_catalogo,nombre"-->
                    <campo name="id_segmento" text="Segmento" autogenerado="true" generacion="@prox()+1" visible="false"/>
                    <campo name="nivel_afectable" text="Nivel Afectable" local="true" type="long" calcCliente="@consultaDirec('select nivel AS afectable from catalog.segmento_mascara where id_unidad_responsable='+%nlPeriodoC.PeriodoC.id_unidad_responsable%+' and id_periodo='+%nlPeriodoC.PeriodoC.id_periodo%+' and id_catalogo='+%id_catalogo%+' and afectable=true','afectable','long','MAGNITUS')" visible="false"/> <!-- validacion="%nivel_afectable%==null" validacionMensaje="El catálogo seleccionado no tiene definido nivel afectable"-->
                    <!--<campo name="nivel_afectable" text="Nivel Afectable" local="true" type="long" calcCliente="@consultaDirec('select nivel AS afectable from catalog.segmento_mascara where id_unidad_responsable='+%nlPeriodoC.PeriodoC.id_unidad_responsable%+' and id_periodo='+%nlPeriodoC.PeriodoC.id_periodo%+' and id_catalogo='+%id_catalogo%+' and afectable=true','afectable','long','MAGNITUS')" validacion="%nivel_afectable%==null" validacionMensaje="El catálogo seleccionado no tiene definido nivel afectable" visible="false"/>-->
                </tabla>
                <estilos>
                    <boton nombre="grabar" visible="true" texto="Continuar" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                </estilos>
                <acciones>
                    <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
            </componente>
        </nivel>
        <nivel id="nlCCatalogoPre" nombre="CatálogosPre" interactivo="false">
            <componente id="nlCCatalogoPre" nombre="CatálogosPre" tipo="cursor">
                <tabla schema="catalog" nombre="catalogos_presupuestales">
                    <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="%nlPeriodoC.PeriodoC.id_unidad_responsable%"/>
                    <campo name="id_periodo" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%nlPeriodoC.PeriodoC.id_periodo%"/>
                    <campo name="id_catalogo" filtroCampo="id_catalogo" filtroOperador="=" filtroValor="%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%"/>
                    <campo name="nombre"/>
                </tabla>
            </componente>
        </nivel>
        <nivel id="nlRegistraCatalogoPre" nombre="Catálogos Presupuestales Seleccionar Opción" mostrarNivelAnterior="false" mostrarProximoNivel="false">
            <componente id="RegistraCatalogoPre" nombre="Catálogos Presupuestales" tipo="formulario">
                <tabla schema="catalog" nombre="catalogos_folio">
                    <campo name="ur" text="ur" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" visible="false"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" visible="true" calc="%nlPeriodoC.PeriodoC.id_periodo%" columnas="3"/>
                    <campo name="catalogo" text="Registro de" local="true" type="string" visible="true" calc="%nlCCatalogoPre.nlCCatalogoPre.nombre%" habilitado="false" columnas="4"/>
                    <campo name="folio_operacion" text="folio_operacion" visible="false" autogenerado="true" generacion="@prox()+1"/>
                    <campo name="fecha_registro" text="fecha_registro"  visible="false" calc="@fechaSistema(&quot;YYYY/MM/dd HH:mm:ss&quot;)"/>
                    <campo name="funcion" text="Opciones" validacion="%funcion%==null" validacionMensaje="Por favor selecciona una acción a realizar" columnas="3">
                        <opciones>
                            <opcion texto="Agregar" valor="Agregar"/>
                            <opcion texto="Eliminar" valor="Eliminar"/>
                        </opciones>
                    </campo>
                </tabla>
                <estilos>
                    <boton nombre="grabar" visible="true" texto="Continuar" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                </estilos>
                <acciones>
                    <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
            </componente>
        </nivel>
        <nivel id="nlTipoRegistroCatalogoPre" nombre="Catálogos Presupuestales" mostrarNivelAnterior="false" ejecutar="%nlRegistraCatalogoPre.RegistraCatalogoPre.funcion%=='Agregar'"><!-- OR %nlRegistraCatalogoPre.RegistraCatalogoPre.funcion%=='Eliminar'"--> 
            <componente id="cpTipoRegistroCatalogoPre" nombre="Catálogos Presupuestales - Opciones de Registro" tipo="formulario" accionDefault="seleccionar">
                <tabla schema="catalog" nombre="periodo">
                    <campo name="id_unidad_responsable" text="UR" llaveForanea="false" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" visible="false"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" llaveForanea="false" calc="%nlPeriodoC.PeriodoC.id_periodo%" visible="true" columnas="3" margen-izquierdo="2"/>
                    <campo name="catalogo" text="Registro de " local="true" type="string" visible="false" calc="%nlCCatalogoPre.nlCCatalogoPre.nombre%" habilitado="false"/>
                    <campo name="funcion" text="Opciones de Registro" local="true" type="string" validacion="%funcion%==null" validacionMensaje="Por favor selecciona una acción a realizar" columnas="3"  margen-derecho="2">
                        <opciones>
                            <opcion texto="Manual" valor="Manual"/>
                            <opcion texto="Importar" valor="Importar"/>
                            <opcion texto="Liberadas" valor="Liberadas"/>
                        </opciones>
                    </campo>
                </tabla>
                <estilos>
                    <boton nombre="grabar" visible="true" texto="Continuar" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                </estilos>
                <acciones>
                    <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
            </componente>
        </nivel>
        <nivel id="nlAgregaCatalogoPre" nombre="Catálogos Presupuestales Agregar" mostrarNivelAnterior="false" mostrarProximoNivel="false" ejecutar="%nlTipoRegistroCatalogoPre.cpTipoRegistroCatalogoPre.funcion%=='Manual'">
            <componente id="nlAgregaCatalogoPre_" nombre="Catálogos Presupuestales" tipo="formulario" accionDefault="seleccionar">
                <tabla schema="catalog" nombre="periodo">
                    <campo name="id_unidad_responsable" text="UR" llaveForanea="false" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" visible="false"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" llaveForanea="false" calc="%nlPeriodoC.PeriodoC.id_periodo%" visible="false" columnas="3" margen-izquierdo="2"/>
                    <campo name="catalogo" text="Registro de" local="true" type="string" visible="true" calc="%nlCCatalogoPre.nlCCatalogoPre.nombre%" columnas="4" margen-derecho="1"/>
                 </tabla>
                <estilos>
                    <boton nombre="grabar" visible="false" texto="Continuar"/>
                </estilos>
            </componente>
            <componente  tipo="tabla" nombre="Catálogos Presupuestales" id="cpAgregarCatalogoPre" filtro="true" mostrarEditar="false" mostrarEliminar="true" mostrarAgregar="true">
                <tabla schema="catalog" nombre="catalogos_aux">
                    <campo name="ur" text="Unidad Responsable" descripcionForanea="descripcion" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" llaveForanea="false" visible="false" columna-visible="false"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" calc="%nlPeriodoC.PeriodoC.id_periodo%" llaveForanea="false" visible="false" columna-visible="false"/>
                    <campo name="id_catalogo" text="Catálogo" calc="%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%" visible="false" columna-visible="false"/>
                    <campo name="folio_operacion" text="Folio" generacion="@prox()+1" autogenerado="true" llaveForanea="false" visible="false" columna-visible="false"/> <!--generacion="@prox()+1"-->
                    <campo name="nivel" text="Clave de Nivel" mascara="##" validacion="%nivel%==null" validacionMensaje="Clave de Nivel Invalida" visible="true" columna-visible="true" columnas="3" />
                    <campo name="val_existe_nivel" type="long" local="true" calc="%nivel%" validacion="!@ValidarRegistro('catalog','segmento_mascara','nivel='+'\\''+%nivel%+'\\''+' AND'+' id_periodo='+'\\''+%nlPeriodoC.PeriodoC.id_periodo%+'\\''+' AND'+' id_catalogo='+'\\''+%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%+'\\'',';','MAGNITUS')" validacionMensaje="El Nivel capturado no esta registrado." visible="false" columna-visible="false"/>
                    <campo name="mascara" text="Mascara" calcCliente="@ifThenElse(%nivel%&lt;=%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.nivel_afectable%,@consultaDirec('SELECT * FROM reportes.mascara_catalogos1('+'\\''+%nlPeriodoC.PeriodoC.id_unidad_responsable%+'\\''+' ,'+'\\''+ %nlPeriodoC.PeriodoC.id_periodo%+'\\''+','+'\\''+@ifThenElse(%nivel%==null,0,%nivel%)+'\\''+','+'\\''+%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%+'\\''+') AS result' ,'result','string','MAGNITUS'),'Nivel no registrado')" habilitado="false" visible="true" columna-visible="false" columnas="4"/>
                    
                    <campo name="id_cat" text="Clave del Registro" ordenar="asc"  validacion="%id_cat%==null" validacionMensaje="Clave del Registro debe capturarse" visible="true" columna-visible="true" columnas="3"/>
                    
                    <campo name="val_id_cat" type="long" local="true" calc="%id_cat%" validacion="@ValidarRegistro('catalog','catalogos_aux','id_cat='+'\\''+%id_cat%+'\\''+' AND'+' id_periodo='+'\\''+%nlPeriodoC.PeriodoC.id_periodo%+'\\''+' AND'+' id_catalogo='+'\\''+%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%+'\\'',';','MAGNITUS')" validacionMensaje="La Clave de Registro capturado ya esta registrado." visible="false" columna-visible="false"/>
                    <campo name="id_cat_lon" text="Longitud Clave de Registro" local="true" type="string" calcCliente="@longitudCadena(%id_cat%)" visible="false" columna-visible="false"/>
                    <campo name="val_lon_nivel" type="long" local="true" calc="%id_cat_lon%" validacion="!@ValidarRegistro('catalog','segmento_mascara','num_caracteres='+%id_cat_lon%+' AND'+' id_periodo='+'\\''+%nlPeriodoC.PeriodoC.id_periodo%+'\\''+' AND'+' id_catalogo='+'\\''+%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%+'\\''+' AND'+' nivel='+'\\''+%nivel%+'\\'',';','MAGNITUS')" validacionMensaje="Clave de Registro no cumple con el largo definido" visible="false" columna-visible="false"/>
                    <campo name="descripcion" text="Descripción" validacion="@ifThenElse(!@matchRegEx(%descripcion%,'^[A-Z 0-9-]*$'), true, false)" validacionMensaje="Descripción del Nivel no puede estar vacio y solo se aceptan mayúsculas y números" visible="true" columna-visible="true" columnas="3"/>
                    <campo name="val_duplicado_descripcion" type="long" local="true" calc="%descripcion%" validacion="@ValidarRegistro('catalog','catalogos_aux','descripcion='+'\\''+%descripcion%+'\\''+' AND'+' id_periodo='+'\\''+%nlPeriodoC.PeriodoC.id_periodo%+'\\'',';','MAGNITUS')" validacionMensaje="La Descripción que se desea registrar ya existe." visible="false" columna-visible="false"/>
                    <campo name="estatus_registro" text="Estatus Registro" descripcionForanea="descripcion" visible="false" columna-visible="true" calc="3"/>
                    <!--filtroCampo="estatus_registro" filtroOperador="=" filtroValor="3"-->
                    <!--filtroCampo="estatus_registro" filtroOperador="=" filtroValor="%estatus_registro%=3 || %estatus_registro%=2"-->
                    
                    <campo name="estatus" text="Estatus" calc="1" llaveForanea="false" visible="false" columna-visible="false"/>
                    <campo name="fecha_registro" text="Fecha de Registro" calc="@fechaSistema(&quot;YYYY/MM/dd HH:mm:ss&quot;)" visible="false" columna-visible="false"/>
                    <campo name="folio_operacion_instancia" text="Folio Operacion" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.folio_operacion%" visible="false" columna-visible="false"/>
                    <campo name="clasificador_economico" text="Clasificador Económico" descripcionForanea="clave,descripcion" llavesFijas="nivel=3" visible="true" columna-visible="false" interaccion-visible="%id_catalogo%==4" validacion="%clasificador_economico%==null AND %id_catalogo%==4" validacionMensaje="Clasificador Económico es un Campo Obligatorio" columnas="4"/>
                    <campo name="clave_cuenta" text="Cuentas Contables" descripcionForanea="clave_cuenta,descripcion" maxlength="50" visible="true" columna-visible="false" interaccion-visible="%id_catalogo%==4" validacion="%clave_cuenta%==null AND %id_catalogo%==4" validacionMensaje="Clave Cuenta es un Campo Obligatorio" columnas="3"/>
                    <campo name="id_catalogo_ref1" text="Catálogo" calc="5" llaveForanea="false" visible="false" columna-visible="false"/>
                    <campo name="id_cat_ref1" text="Fuente de Financiamiento"  descripcionForanea="id_cat,descripcion" llavesFijas="nivel=2" interaccion-visible="%id_catalogo%==3 AND %nivel%==%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.nivel_afectable%" visible="true" columna-visible="false" columnas="3" validacion="%nivel%==%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.nivel_afectable%==true AND %id_cat_ref1%==null AND %id_catalogo%==3" validacionMensaje="Fuente de Financiamiento es un Campo Obligatorio"/>
                     <campo name="afectable" text="Detalle" calcCliente="@consultaDirec('SELECT afectable AS result FROM catalog.segmento_mascara WHERE id_unidad_responsable='+%nlPeriodoC.PeriodoC.id_unidad_responsable%+' AND id_periodo='+%nlPeriodoC.PeriodoC.id_periodo%+' AND nivel='+%nivel%+' AND id_catalogo=' +%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%,'result','bool','MAGNITUS')" visible="true" columna-visible="true" columnas="3" habilitado="false"/>
                
                    <campo name="usuario_modificador" text="Usuario" calc="%nlUsuariosC.UsuariosC.id_usuario%" visible="false" columna-visible="false"/>
                    <campo name="folio" text="Folio" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.folio_operacion%" local="true" type="string" visible="false" columna-visible="false"/>
                    
                    <tareas>
                            <tarea nombre="Agregar Claves" imagen="resources/img/button-default.png" imagen-sobre="resources/img/button-default-rollover.png" params="ur,id_periodo,id_catalogo,id_cat,nivel,folio_operacion_instancia,folio,usuario_modificador" ref="task=0a33d656-7946-4ba0-8e94-ba357c1eb6e1"/>                          
                    </tareas>
                    <validaciones>
                             <validacion tipo="borrar" validacion="%estatus_registro%!=3" validacionMensaje="'Registro no puede ser borrado'"/>
                    </validaciones>
                </tabla>
                <acciones>
                <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
                <estilos>
                    <boton nombre="grabar" posicion="derecha" visible="true" texto="Continuar"/>
                    <boton nombre="formulario" visible="true" texto="Guardar" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                </estilos>
            </componente>
        </nivel>
        <nivel id="nlEliCatalogoPre" nombre="Catálogos Presupuestales Eliminar" mostrarNivelAnterior="false" mostrarProximoNivel="false" ejecutar="%nlRegistraCatalogoPre.RegistraCatalogoPre.funcion%=='Eliminar'">
            <componente id="nlEliCatalogoPre_" nombre="Catálogos Presupuestales" tipo="formulario" accionDefault="seleccionar">
                <tabla schema="catalog" nombre="periodo">
                    <campo name="id_unidad_responsable" text="UR" llaveForanea="false" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" visible="false"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" llaveForanea="false" calc="%nlPeriodoC.PeriodoC.id_periodo%" visible="true" columnas="3" margen-izquierdo="2"/>
                    <campo name="catalogo" text="Registro de" local="true" type="string" visible="true" calc="%nlCCatalogoPre.nlCCatalogoPre.nombre%" columnas="3" margen-derecho="2"/>
                 </tabla>
                <estilos>
                    <boton nombre="grabar" visible="false" texto="Continuar"/>
                </estilos>
            </componente>
            <componente id="cpEliCatalogoPre" tipo="tabla" nombre="Catálogos Presupuestales Eliminar" filtro="true" mostrarEditar="false" mostrarEliminar="false" mostrarAgregar="false" exportarExcel="false" exportarPDF="false">
                <tabla schema="catalog" nombre="catalogos">
                    <campo name="ur" text="Unidad Responsable" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" llaveForanea="false" columna-visible="false"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" calc="%nlPeriodoC.PeriodoC.id_periodo%" llaveForanea="false" columna-visible="false"/>
                    <campo name="id_catalogo" text="Catálogo" calc="%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%" visible="false" columna-visible="false"/>
                    <campo name="nivel" text="Clave de Nivel" columna-visible="true"/>
                    <campo name="id_cat" text="Clave del Registro" ordenar="asc" columna-visible="true"/>
                    <campo name="descripcion" text="Descripción" visible="true" columna-visible="true"/>
                    <campo name="estatus_registro" text="Estatus Registro" calc="3" descripcionForanea="descripcion" visible="false" columna-visible="true"/>
                    <campo name="estatus" text="Estatus" calc="1" llaveForanea="false" visible="false" columna-visible="false"/>
                    <campo name="fecha_registro" text="Fecha de Registro" columna-visible="false"/>
                    <campo name="clasificador_economico" text="Clasificador Económico" descripcionForanea="descripcion" llavesFijas="nivel=3" visible="true" columna-visible="false" interaccion-visible="%id_catalogo%==4"/>
                    <campo name="clave_cuenta" text="Cuentas Contables" maxlength="500" columna-visible="false"/>
                    <campo name="usuario_modificador" text="Usuario" calc="%nlUsuariosC.UsuariosC.id_usuario%" visible="false" columna-visible="false"/>
                    <campo name="folio" text="Folio" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.folio_operacion%" local="true" type="string" visible="false" columna-visible="false"/>
                    <tareas>
                            <tarea nombre="Eliminar Claves" imagen="resources/img/button-default.png" imagen-sobre="resources/img/button-default-rollover.png" params="ur,id_periodo,id_catalogo,id_cat,nivel,folio,usuario_modificador" ref="task=b9dc0396-bc69-405c-ac48-9a64fc0726de"/>                          
                    </tareas>
                </tabla>
                <acciones>
                    <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
                <estilos>
                    <boton nombre="grabar" posicion="derecha" visible="true" texto="Continuar"/>
                </estilos>
            </componente>
        </nivel>
        <nivel id="nlImportaCatalogoPre" nombre="Catálogos Presupuestales Importación" mostrarNivelAnterior="false" mostrarProximoNivel="false" ejecutar="%nlTipoRegistroCatalogoPre.cpTipoRegistroCatalogoPre.funcion%=='Importar'">
            <componente id="nlImportaCatalogoPre_" nombre="Catálogos Presupuestales" tipo="formulario" accionDefault="seleccionar">
                <tabla schema="catalog" nombre="periodo">
                    <campo name="id_unidad_responsable" text="UR" llaveForanea="false" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" visible="false"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" llaveForanea="false" calc="%nlPeriodoC.PeriodoC.id_periodo%" visible="true" columnas="3" margen-izquierdo="2"/>
                    <campo name="catalogo" text="Registro de" local="true" type="string" visible="true" calc="%nlCCatalogoPre.nlCCatalogoPre.nombre%" columnas="3" margen-derecho="2"/>
                 </tabla>
                <estilos>
                    <boton nombre="grabar" visible="false" texto="Continuar"/>
                </estilos>
            </componente>
            <componente  tipo="tabla" nombre="Catálogos Presupuestales" id="cpImportaCatalogoPre" filtro="true" mostrarEliminar="false" mostrarEditar="false" mostrarAgregar="false" mostrarImportacion="true">
                <tabla schema="catalog" nombre="catalogos_aux">
                    <campo name="ur" text="Unidad Responsable"  llaveForanea="false" visible="false" columna-visible="false" columnaImportacion="Unidad Responsable" validacionImportacion="@ifThenElse(%Unidad Responsable%=='', true, false )" columnaImportacionVisible="false" importacion="true" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" llaveForanea="false" visible="false" columna-visible="false" columnaImportacion="Periodo" validacionImportacion="@ifThenElse(%Periodo%=='', true, false )" columnaImportacionVisible="false" importacion="true" calc="%nlPeriodoC.PeriodoC.id_periodo%"/>
                    <campo name="id_catalogo" text="Catálogo" llaveForanea="false" visible="false" columna-visible="false" filtroCampo="id_catalogo" filtroOperador="=" filtroValor="%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%" columnaImportacion="Catalogo" validacionImportacion="@ifThenElse(%id_catalogo%!=%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo% ,true,false)" columnaImportacionVisible="true" importacion="true"/>
                    <campo name="folio_operacion" text="Folio" autogenerado="true" generacion="@prox()+1" columna-visible="false" visible="false" importacion="true"/>
                    <campo name="nivel" text="Clave de Nivel" visible="false" columna-visible="true" columnaImportacion="Nivel" validacionImportacion="@ifThenElse(%nivel%=='', true, false )" columnaImportacionVisible="true" importacion="true"/>
                    <campo name="id_cat" text="Clave del Registro" visible="false" columna-visible="true" columnaImportacion="Registro" validacionImportacion="@ifThenElse(%id_cat%=='', true, false )" columnaImportacionVisible="true" importacion="true"/>
                    <campo name="descripcion" text="Descripción" visible="false" columna-visible="true" columnaImportacion="Descripcion" validacionImportacion="@ifThenElse(%descripcion%=='', true, false )" columnaImportacionVisible="true" importacion="true"/>
                    <campo name="estatus_registro" text="Estatus Registro" calc="3" descripcionForanea="descripcion" visible="false" columna-visible="true" importacion="true"/>
                    <campo name="estatus" text="Estatus" calc="1" llaveForanea="false" visible="false" columna-visible="false" importacion="true"/>
                    <campo name="fecha_registro" text="Fecha de Registro" calc="@fechaSistema(&quot;YYYY/MM/dd HH:mm:ss&quot;)" visible="false" columna-visible="false" importacion="true"/>
                    <campo name="folio_operacion_instancia" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.folio_operacion%" text="Folio Operacion" visible="false" columna-visible="false" importacion="true"/>
                    <campo name="clasificador_economico" text="Clasificador Economico" visible="false" columna-visible="false" columnaImportacion="Clasificador Economico" validacionImportacion="@ifThenElse(%clasificador_economico%=='', true, false)" columnaImportacionVisible="true" importacion="true"/>
                    <campo name="clave_cuenta" text="Cuenta Contable" visible="false" columna-visible="false" columnaImportacion="Cuenta Contable" validacionImportacion="@ifThenElse(%clave_cuenta%=='', true, false)" columnaImportacionVisible="true" importacion="true"/>
                    <campo name="id_catalogo_ref1" text="Fuente" visible="false" columna-visible="false" columnaImportacion="Fuente" columnaImportacionVisible="true" importacion="true"/> <!-- validacionImportacion="@ifThenElse(%Fuente%=='', true, false)"-->
                    <campo name="id_cat_ref1" text="Fuente de Financiamiento" visible="false" columna-visible="false" columnaImportacion="Fuente de Financiamiento" columnaImportacionVisible="true" importacion="true"/> <!-- validacionImportacion="@ifThenElse(%Fuente de Financiamiento%=='', true, false)"-->
                </tabla>
                <acciones>
                    <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
                <estilos>
                    <boton nombre="grabar" posicion="derecha" visible="true" texto="Continuar"/>
                </estilos>
            </componente>
        </nivel>
        <nivel id="nlLiberadasCatalogoPre" nombre="Catálogos Presupuestales Agregar" mostrarNivelAnterior="false" mostrarProximoNivel="false" ejecutar="%nlTipoRegistroCatalogoPre.cpTipoRegistroCatalogoPre.funcion%=='Liberadas'">
            <componente id="nlLiberadasCatalogoPre_" nombre="Catálogos Presupuestales" tipo="formulario" accionDefault="seleccionar">
                <tabla schema="catalog" nombre="periodo">
                    <campo name="id_unidad_responsable" text="UR" llaveForanea="false" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" visible="false"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" llaveForanea="false" calc="%nlPeriodoC.PeriodoC.id_periodo%" visible="true" columnas="3" margen-izquierdo="2"/>
                    <campo name="catalogo" text="Registro de" local="true" type="string" visible="true" calc="%nlCCatalogoPre.nlCCatalogoPre.nombre%" columnas="3" margen-derecho="2"/>
                 </tabla>
                <estilos>
                    <boton nombre="grabar" visible="false" texto="Continuar"/>
                </estilos>
            </componente>
            <componente  tipo="tabla" accionDefault="editar" nombre="Catálogos Presupuestales" id="cpLiberadasCatalogoPre" filtro="true" mostrarAgregar="false" mostrarEditar="false" mostrarEliminar="false">
                <tabla schema="catalog" nombre="catalogos_aux">
                    <campo name="ur" text="Unidad Responsable" descripcionForanea="descripcion" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" llaveForanea="false" visible="false" columna-visible="false"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" calc="%nlPeriodoC.PeriodoC.id_periodo%" llaveForanea="false" visible="false" columna-visible="false"/>
                    <campo name="id_catalogo" text="Catálogo" calc="%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%" visible="false" columna-visible="false"/>
                    <campo name="folio_operacion" text="Folio" generacion="@prox()+1" autogenerado="true" visible="false" columna-visible="false"/>
                    <campo name="nivel" text="Clave de Nivel" mascara="##" validacion="%nivel%==null" validacionMensaje="Clave de Nivel debe capturarse" visible="true" columna-visible="true" columnas="3"/>
                    <campo name="val_existe_nivel" type="long" local="true" calc="%nivel%" validacion="!@ValidarRegistro('catalog','segmento_mascara','nivel='+'\\''+%nivel%+'\\''+' AND'+' id_periodo='+'\\''+%nlPeriodoC.PeriodoC.id_periodo%+'\\''+' AND'+' id_catalogo='+'\\''+%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%+'\\'',';','MAGNITUS')" validacionMensaje="El Nivel capturado no esta registrado." visible="false" columna-visible="false"/>
                    <campo name="mascara" text="Mascara" calcCliente="@consultaDirec('SELECT * FROM reportes.mascara_catalogos1('+'\\''+%nlPeriodoC.PeriodoC.id_unidad_responsable%+'\\''+' ,'+'\\''+ %nlPeriodoC.PeriodoC.id_periodo%+'\\''+','+'\\''+@ifThenElse(%nivel%==null,0,%nivel%)+'\\''+','+'\\''+%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%+'\\''+') AS result' ,'result','string','MAGNITUS')" habilitado="false" visible="true" columna-visible="false" columnas="3" margen-derecho="2"/>
                    <campo name="id_cat" text="Clave del Registro" mascara="##" validacion="%id_cat%==null" validacionMensaje="Clave del Registro debe capturarse" visible="true" columna-visible="true" columnas="4"/>
                    <campo name="val_id_cat" type="long" local="true" calc="%id_cat%" validacion="@ValidarRegistro('catalog','catalogos_aux','id_cat='+'\\''+%id_cat%+'\\''+' AND'+' id_periodo='+'\\''+%nlPeriodoC.PeriodoC.id_periodo%+'\\''+' AND'+' id_catalogo='+'\\''+%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%+'\\'',';','MAGNITUS')" validacionMensaje="La Clave de Registro capturado ya esta registrado." visible="false" columna-visible="false"/>
                    <campo name="id_cat_lon" text="Longitud Clave de Registro" local="true" type="string" calcCliente="@longitudCadena(%id_cat%)" visible="false" columna-visible="false"/>
                    <campo name="val_lon_nivel" type="long" local="true" calc="%id_cat_lon%" validacion="!@ValidarRegistro('catalog','segmento_mascara','num_caracteres='+%id_cat_lon%+' AND'+' id_periodo='+'\\''+%nlPeriodoC.PeriodoC.id_periodo%+'\\''+' AND'+' id_catalogo='+'\\''+%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%+'\\''+' AND'+' nivel='+'\\''+%nivel%+'\\'',';','MAGNITUS')" validacionMensaje="Clave de Registro no cumple con el largo definido" visible="false" columna-visible="false"/>
                    <campo name="descripcion" text="Descripción" mascara="C" validacion="%descripcion%==null" validacionMensaje="Descripción del Nivel debe capturarse" visible="true" columna-visible="true" columnas="3"/>
                    <campo name="val_duplicado_descripcion" type="long" local="true" calc="%descripcion%" validacion="@ValidarRegistro('catalog','catalogos_aux','descripcion='+'\\''+%descripcion%+'\\''+' AND'+' id_periodo='+'\\''+%nlPeriodoC.PeriodoC.id_periodo%+'\\'',';','MAGNITUS')" validacionMensaje="La Descripción que se desea registrar ya existe." visible="false" columna-visible="false"/>
                    <campo name="estatus_registro" text="Estatus Registro" filtroCampo="estatus_registro" filtroOperador="=" filtroValor="4" llaveForanea="false" visible="false" columna-visible="false" descripcionForaneaTabla="descripcion"/>
                    <campo name="estatus" text="Estatus" calc="1" llaveForanea="false" visible="true" columna-visible="false"/>
                    <campo name="fecha_registro" text="Fecha de Registro" calc="@fechaSistema(&quot;YYYY/MM/dd HH:mm:ss&quot;)" visible="false" columna-visible="false"/>
                    <campo name="folio_operacion_instancia" text="Folio Operacion" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.folio_operacion%" visible="false" columna-visible="false"/>
                    <campo name="clasificador_economico" text="Clasificador Económico" descripcionForanea="clave,descripcion" llavesFijas="nivel=3" visible="true" columna-visible="false" interaccion-visible="%id_catalogo%==4" validacion="%clasificador_economico%==null AND %id_catalogo%==4" validacionMensaje="Clasificador Económico es un Campo Obligatorio" columnas="3"/>
                    <campo name="clave_cuenta" text="Cuentas Contables" descripcionForanea="clave_cuenta,descripcion" maxlength="50" visible="true" columna-visible="false" interaccion-visible="%id_catalogo%==4" validacion="%clave_cuenta%==null AND %id_catalogo%==4" validacionMensaje="Clave Cuenta es un Campo Obligatorio" columnas="4"/>
                    <campo name="id_catalogo_ref1" text="Catálogo" calc="5" llaveForanea="false" visible="false" columna-visible="false"/>
                    <campo name="id_cat_ref1" text="Fuente de Financiamiento"  descripcionForanea="id_cat,descripcion" llavesFijas="nivel=2" interaccion-visible="%id_catalogo%==3" visible="true" columna-visible="false" columnas="3" validacion="%id_cat_ref1%==null AND %id_catalogo%==3" validacionMensaje="Fuente de Financiamiento es un Campo Obligatorio"/>
                    <!--<campo name="clasificador_economico" text="Clasificador Económico" descripcionForanea="descripcion" llavesFijas="nivel=3" visible="true" columna-visible="false" interaccion-visible="%id_catalogo%==4"/>
                    <campo name="clave_cuenta" text="Cuentas Contables" autoFiltrado="true" autoFiltradoDescripcion="clave_cuenta,descripcion" maxlength="50" visible="true" columna-visible="false" interaccion-visible="%id_catalogo%==4" columnas="3"  margen-derecho="2"/>
                    <campo name="id_catalogo_ref1" text="Catálogo" calc="5" llaveForanea="false" visible="false" columna-visible="false"/>
                    <campo name="id_cat_ref1" text="Fuente de Financiamiento" autoFiltrado="true" autoFiltradoDescripcion="id_cat,descripcion" maxlength="50" visible="true" columna-visible="false" interaccion-visible="%id_catalogo%==3" columnas="3"  margen-izquierdo="2"/>-->
                    <campo name="usuario_modificador" text="Usuario" calc="%nlUsuariosC.UsuariosC.id_usuario%" visible="false" columna-visible="false"/>
                    <campo name="folio" text="Folio" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.folio_operacion%" local="true" type="string" visible="false" columna-visible="false"/>
                    <campo name="seleccion_liberados" text="Instanciar" editable="true" visible="false" columna-visible="true" columnas="3"  />
                    <!--<tareas>
                            <tarea nombre="Agregar Claves" imagen="resources/img/button-default.png" imagen-sobre="resources/img/button-default-rollover.png" params="ur,id_periodo,id_catalogo,id_cat,nivel,folio_operacion_instancia,folio,usuario_modificador" ref="task=0a33d656-7946-4ba0-8e94-ba357c1eb6e1"/>                          
                    </tareas>-->
                    <validaciones>
                             <validacion tipo="borrar" validacion="%estatus_registro%!=3" validacionMensaje="'Registro no puede ser borrado'"/>
                    </validaciones>
                </tabla>
                <acciones>
                    <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                </acciones>
                <estilos>
                    <boton nombre="grabar" posicion="derecha" visible="true" texto="Continuar"/>
                    <boton nombre="formulario" visible="true" texto="Guardar" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                </estilos>
            </componente>
        </nivel>
        <nivel id="CursorLiberadas" nombre="CursorLiberadas" interactivo="false" ejecutar="%nlTipoRegistroCatalogoPre.cpTipoRegistroCatalogoPre.funcion%=='Liberadas'">
            <componente  tipo="cursor" nombre="CursorLiberadas" id="CursorLiberadas">
                <tabla schema="catalog" nombre="catalogos_aux">
                    <campo name="ur" text="Unidad Responsable" descripcionForanea="descripcion" filtroCampo="ur" filtroOperador="=" filtroValor="%nlPeriodoC.PeriodoC.id_unidad_responsable%"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%nlPeriodoC.PeriodoC.id_periodo%" llaveForanea="false"/>
                    <campo name="id_catalogo" text="Catálogo" filtroCampo="id_catalogo" filtroOperador="=" filtroValor="%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%"/>
                    <campo name="folio_operacion" text="Folio"/>
                    <campo name="id_cat" text="Clave del Registro"/>
                    <campo name="estatus_registro" text="Estatus Registro" calc="1" filtroCampo="estatus_registro" filtroOperador="=" filtroValor="4"/>
                    <campo name="folio_operacion_instancia" text="Folio Operacion" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.folio_operacion%"/>
                    <campo name="usuario_modificador" text="Usuario" calc="%nlUsuariosC.UsuariosC.id_usuario%"/>
                    <campo name="seleccion_liberados" text="Seleccionar" filtroCampo="seleccion_liberados" filtroOperador="=" filtroValor="'true'"/>
                </tabla>
            </componente>
        </nivel>
        <nivel id="CursorAgregar" nombre="CursorAgregar" interactivo="false" ejecutar="%nlTipoRegistroCatalogoPre.cpTipoRegistroCatalogoPre.funcion%=='Manual' OR %nlTipoRegistroCatalogoPre.cpTipoRegistroCatalogoPre.funcion%=='Importar'">
            <componente  tipo="cursor" nombre="CursorAgregar" id="CursorAgregar">
                <tabla schema="catalog" nombre="catalogos_aux">
                    <campo name="ur" text="Unidad Responsable" descripcionForanea="descripcion" filtroCampo="ur" filtroOperador="=" filtroValor="%nlPeriodoC.PeriodoC.id_unidad_responsable%"/>
                    <campo name="id_periodo" text="Ejercicio Fiscal" filtroCampo="id_periodo" filtroOperador="=" filtroValor="%nlPeriodoC.PeriodoC.id_periodo%" llaveForanea="false"/>
                    <campo name="id_catalogo" text="Catálogo" filtroCampo="id_catalogo" filtroOperador="=" filtroValor="%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%"/>
                    <campo name="folio_operacion" text="Folio"/>
                    <campo name="id_cat" text="Clave del Registro"/>
                    <campo name="estatus_registro" text="Estatus Registro" calc="1" filtroCampo="estatus_registro" filtroOperador="=" filtroValor="3"/>
                    <campo name="folio_operacion_instancia" text="Folio Operacion" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.folio_operacion%"/>
                    <campo name="usuario_modificador" text="Usuario" calc="%nlUsuariosC.UsuariosC.id_usuario%"/>
                    <campo name="folio_operacion_instancia" text="Folio" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.folio_operacion%"/>
                </tabla>
            </componente>
        </nivel>
        <nivel nombre="Agregar Catálogos Presupuestales" id="nlAgrInsCta" interactivo="false" ejecutar="%nlRegistraCatalogoPre.RegistraCatalogoPre.funcion%=='Agregar' OR %nlRegistraCatalogoPre.RegistraCatalogoPre.funcion%=='Eliminar'">
            <componente tipo="solicitud" nombre="EnvioParametrosInstancia" id="nlAgrInsCta">
                <parametros url="$config.request$" metodo="POST" accion="crearNuevaInstancia" tipo="json">
                    <parametro name="enterprise" calc="'MAGNITUS'"/>
                    <parametro name="process" calc="'8c17387e-cbb8-42d7-be4e-5fd0aef8a4fc'"/>
                    <parametro name="user" calc="$protocolarios.user$"/>
                    <parametro name="out_ur" calc="%nlPeriodoC.PeriodoC.id_unidad_responsable%" mostrarEsc="true"/>
                    <parametro name="out_periodo" calc="%nlPeriodoC.PeriodoC.id_periodo%" mostrarEsc="true"/>
                    <parametro name="out_id_catalogo" calc="%nlGestionCatalogoPre.cpSeleccionarCatPresupuestal.id_catalogo%" mostrarEsc="true"/>
                    <parametro name="out_fecha_registro" calc="@fechaSistema()" mostrarEsc="true"/>
                    <parametro name="out_opcion" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.funcion%" mostrarEsc="true"/>
                    <parametro name="out_folio_operacion" calc="%nlRegistraCatalogoPre.RegistraCatalogoPre.folio_operacion%" mostrarEsc="true"/>
                </parametros>
            </componente>
        </nivel>
    </pagina>
</tarea>