<tarea id="RegistraRecepcionBienesServicios" nombre="Registra Recepción de Bienes y Servicios">
    <pagina id="1">
        <nivel id="barreUsuarios" nombre="barreUsuarios" interactivo="false">
            <componente id="barreUsuarios" nombre="barreUsuarios" tipo="cursor">
                <tabla schema="entity" nombre="usuario">
                    <campo name="id_unidad_responsable" filtroCampo="id_unidad_responsable" filtroOperador="=" filtroValor="$config.ur$"/>
                    <campo name="id_usuario"/>
                    <campo name="nombre_usuario" filtroCampo="nombre_usuario" filtroOperador="=" filtroValor="$protocolarios.user$"/>
                </tabla>
            </componente>
        </nivel>
        <nivel nombre="Filtra Duep" id="FD" interactivo="false">
            <componente tipo="cursor" nombre="Filtra Duep" id="FD" >
                <tabla schema="operation" nombre="duep">
                    <campo name="ur" filtroCampo="ur" filtroOperador="=" filtroValor="$inParam.ur$"/>
                    <campo name="periodo"  filtroCampo="periodo" filtroOperador="=" filtroValor="$inParam.periodo$"/>
                    <campo name="folio_duep"  filtroCampo="folio_duep" filtroOperador="=" filtroValor="$inParam.duep$"/>
                    <campo name="id_contrato"/>

                </tabla>
            </componente>
        </nivel>
        <nivel id="nlGesRecepcionBSDet" nombre="Registra Recepción de Bienes o Servicio" mostrarNivelAnterior="false" mostrarProximoNivel="false">
            <componente tipo="tabla" id="cpGesRecepcionBSDet" nombre="Registra Recepción de Bienes o Servicio" mostrarEditar="true" mostrarAgregar="false" mostrarEliminar="false">        
                    <tabla schema="operation" nombre="duep_contrato_pedido_det">
                        <campo name="ur" text="Unidad Responsable" filtroCampo="ur" filtroOperador="=" filtroValor="$inParam.ur$" calc="$inParam.ur$" llaveForanea="false" visible="false" columna-visible="false"/>
                        <campo name="periodo" text="Periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="$inParam.periodo$" calc="$inParam.periodo$" llaveForanea="false" visible="false" columna-visible="false"/>
                        <campo name="id_duep_contrato_pedido" text="Contrato Pedido" filtroCampo="id_duep_contrato_pedido" filtroOperador="=" filtroValor="%FD.FD.id_contrato%" llaveForanea="false" visible="false" columna-visible="false" calc="%FD.FD.id_contrato%"/>
                        <campo name="id_duep_contrato_pedido_det" text="Renglón" width="100" habilitado="false" visible="false" columna-visible="true"/>
                        <campo name="clave_articulo" text="Clave del articulo" width="200" descripcionForanea="descripcion_articulo" descripcionForaneaTabla="descripcion_articulo" habilitado="false" visible="true" columna-visible="true" columnas="3" margen-izquierdo="2" margen-derecho="5"/>
                        <campo name="fecha_registro" text="Fecha de Recepción" calc="@fechaSistema(&quot;YYYY/MM/dd HH:mm:ss&quot;)" habilitado="false" visible="true" columna-visible="true" columnas="3" margen-izquierdo="2" margen-derecho="5"/>
                        <campo name="cantidad" text="Cantidad Solicitada" width="200" habilitado="false" visible="false" columna-visible="true"/> 
                        <campo name="cantidad_recibida_rbs" text="Cantidad Recibida" width="200" habilitado="true" visible="true" columna-visible="true" columnas="3" margen-izquierdo="2" margen-derecho="5"
                        validacionModificacion="%cantidad_recibida_rbs%==0.00 OR %cantidad%&lt;%cantidad_recibida_rbs%" validacionModificacionMensaje="Cantidad no puede ser '0' y no puede ser mayor a la cantidad Solicitada" />
                        
                        <campo name="unidad_medida" text="Unidad Medida" width="200" descripcionForanea="descripcion" descripcionForaneaTabla="descripcion" habilitado="false" visible="false" columna-visible="true"/> 
                        
                        <campo name="recepcion_acumulada" text="Recepción Acumulada" width="200" habilitado="false" visible="false" columna-visible="true" calc="@consultaDirec('SELECT SUM(cantidad_recibida) AS result FROM operation.duep_contrato_pedido_det
                        WHERE ur='+$inParam.ur$+' AND periodo='+$inParam.periodo$+' AND id_duep_contrato_pedido='+%FD.FD.id_contrato%,'result','long','MAGNITUS')"/>
                        <campo name="cantidad_recibida" text="Cantidad Recibida" width="200" habilitado="false" visible="false" columna-visible="false" columnas="3" margen-izquierdo="2" margen-derecho="5" calc="@consultaDirec('SELECT SUM(cantidad_recibida_rbs) AS result FROM operation.duep_contrato_pedido_det
                        WHERE ur='+$inParam.ur$+' AND periodo='+$inParam.periodo$+' AND id_duep_contrato_pedido='+%FD.FD.id_contrato%,'result','long','MAGNITUS')"/>
                        <campo name="cantidad_en_proceso" text="Cantidad en Proceso" visible="false" columna-visible="false"/>
                        
                        <campo name="cantidad_por_recibir" text="Por Recibir" width="200"  habilitado="false" visible="true" columna-visible="true" columnas="3" margen-izquierdo="2" margen-derecho="5" calcCliente="%cantidad%-%cantidad_recibida_rbs%"/>
                        
                        <campo name="valcantidad" text="Por Recibir" width="200" habilitado="false" visible="false" columna-visible="false" columnas="3" margen-izquierdo="2" margen-derecho="5" local="true" type="long" validacion="%cantidad_por_recibir%&lt;%cantidad_recibida_rbs%" validacionMensaje="La Cantidad Recibida es mayor"/>
                        
                        <campo name="seleccion_rbs" text="Campo de Selección" editable="true" width="200" visible="true" columna-visible="true" columnas="3" margen-izquierdo="2" margen-derecho="5"/>
                        <!--<campo name="folio_rbs" text="Folio Temporal DUEP" calc="%AsignaFolioRBS.AsignaFolioRBS.folio_duep%" visible="false" columna-visible="false"/>-->
                    </tabla>
                    <acciones>
                        <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                    </acciones>
                    <estilos>
                        <boton nombre="grabar" visible="true" texto="Continuar" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                        <boton nombre="formulario" visible="true" texto="Guardar" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                    </estilos>
            </componente>
            <!--<validaciones>
                    <validacion tipo="avanzar" validacion="@consultaDirec('SELECT count(*)  AS resultado FROM operation.duep_contrato_pedido_det
                        WHERE ur='+$param.ur$+' AND periodo='+$param.periodo$+' AND id_duep_contrato_pedido='+$param.id_duep_contrato_pedido$+' AND seleccion_rbs=true','resultado','int','MAGNITUS')==0 OR @consultaDirec('SELECT count(*)  AS resultado
                        FROM operation.duep_contrato_pedido_det
                        WHERE ur='+$param.ur$+' AND periodo='+$param.periodo$+' AND id_duep_contrato_pedido='+$param.id_duep_contrato_pedido$+' AND seleccion_rbs=true','resultado','int','MAGNITUS')&gt;1" validacionMensaje="'Debe Seleccionar por lo menos un Registro'"/>
            </validaciones>-->
        </nivel>
        <nivel id="GrabaDuepBS" nombre="GrabaDuepBS" interactivo="false">
            <componente tipo="cursor" id="GrabaDuepBS" nombre="GrabaDuepBS">        
                    <tabla schema="operation" nombre="duep_contrato_pedido">
                        <campo name="ur" text="Unidad Responsable" filtroCampo="ur" filtroOperador="=" filtroValor="$inParam.ur$" llaveForanea="false"/>
                        <campo name="periodo" text="Periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="$inParam.periodo$" llaveForanea="false"/>
                        <campo name="id_duep_contrato_pedido" text="Contrato Pedido" filtroCampo="id_duep_contrato_pedido" filtroOperador="=" filtroValor="%FD.FD.id_contrato%"/>
                        <campo name="proveedor" text="Beneficiario" llaveForanea="false"/>
                        <campo name="requiere_anticipo" />
                        <campo name="anticipo"/>
                        <!--<campo name="id_fondo_contable" text="Fondo Contable" llaveForanea="false"/>-->
                        <!--<campo name="area_requiriente" text="Unidad Ejecutora" llaveForanea="false"/>-->
                        <!--<campo name="fuente_financiamiento" text="Fuente Financiamiento" llaveForanea="false"/>-->
                        <!--<campo name="id_tipo_comprobante" text="Tipo Comprobante" llaveForanea="false"/>-->
                        <!--<campo name="folio_con_ordecom"/>-->
                        <!--<campo name="concepto"/>-->
                        <!--<campo name="requiere_anticipo" />-->
                        <!--<campo name="anticipo"/>-->
                        <!--<campo name="cantidad_recibida" calcCliente="@consultaDirec('SELECT sum(cantidad_recibida)  AS cantidad FROM operation.duep_contrato_pedido-->
                        <!--WHERE ur='+%buscaPeriodo.buscaPeriodo.id_unidad_responsable%+' AND periodo='+%buscaPeriodo.buscaPeriodo.id_periodo%+' AND id_duep_contrato_pedido='+%id_duep_contrato_pedido%,'cantidad','int','MAGNITUS')"/>-->
                        <!--<campo name="cantidad_por_recibir" calcCliente="@consultaDirec('SELECT sum(cantidad)  AS cantidad FROM operation.duep_contrato_pedido-->
                        <!--WHERE ur='+%buscaPeriodo.buscaPeriodo.id_unidad_responsable%+' AND periodo='+%buscaPeriodo.buscaPeriodo.id_periodo%+' AND id_duep_contrato_pedido='+%id_duep_contrato_pedido%,'cantidad','int','MAGNITUS')-@consultaDirec('SELECT sum(cantidad_recibida)  AS cantidad FROM operation.duep_contrato_pedido-->
                        <!--WHERE ur='+%buscaPeriodo.buscaPeriodo.id_unidad_responsable%+' AND periodo='+%buscaPeriodo.buscaPeriodo.id_periodo%+' AND id_duep_contrato_pedido='+%id_duep_contrato_pedido%,'cantidad','int','MAGNITUS')"/>-->
                        <!--<campo name="seleccion_rbs" text="Campo de Selección" filtroCampo="seleccion_rbs" filtroOperador="=" filtroValor="true"/>-->
                        <campo name="folio_rbs" text="Folio DUEP"/>
                        <campo name="folio_adquisiciones"/>
                        <campo name="folio_req"/>
                    </tabla>
                </componente>
            </nivel>
        
        <nivel id="GrabaDuepBSD" nombre="GrabaDuepBSD" interactivo="false">
            <componente tipo="cursor" id="GrabaDuepBSD" nombre="GrabaDuepBSD">        
                    <tabla schema="operation" nombre="duep_contrato_pedido_det">
                        <campo name="ur" text="Unidad Responsable" filtroCampo="ur" filtroOperador="=" filtroValor="$inParam.ur$" llaveForanea="false"/>
                        <campo name="periodo" text="Periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="$inParam.periodo$" llaveForanea="false"/>
                        <campo name="id_duep_contrato_pedido" text="Contrato Pedido" filtroCampo="id_duep_contrato_pedido" filtroOperador="=" filtroValor="%FD.FD.id_contrato%"/>
                        <campo name="id_duep_contrato_pedido_det" text="Renglón"/>
                        <campo name="clave_articulo" text="Articulo"/>
                        <campo name="cantidad_recibida" text="Cantidad Recibida"/>
                        <campo name="cantidad_recibida_rbs" text="Cantidad Recibida"/>
                        <campo name="cantidad_por_recibir" text="Cantidad por Recibir"/>
                        <campo name="id_cat_cog" text="COG"/>
                        <campo name="clasificador_objeto_gasto" text="COG"/>
                        <campo name="unidad_medida" text="Unidad de Medida"/>
                        <campo name="precio_unitario" text="PU"/>
                        <campo name="importe_unitario" text="IU"/>
                        <campo name="programa_presupuestal" text="PP"/>
                        <campo name="descuento" text="Descuento"/>
                        <campo name="tasa_iva" text="Tasa IVA"/>
                        <campo name="clave_presup" text="Clave Presupuestal"/>
                        <campo name="imp_valor_agregado" text="Impuesto al Valor Agregado"/>
                        <campo name="otros_impuestos" text="Otros Impuestos"/>
                        <campo name="seleccion_rbs" text="Campo de Selección" filtroCampo="seleccion_rbs" filtroOperador="=" filtroValor="true"/>
                        <campo name="estatus_seleccion" text="estatus_seleccion" filtroCampo="estatus_seleccion" filtroOperador="=" filtroValor="false"/>
                        <!--<campo name="folio_rbs" text="Folio DUEP" filtroCampo="folio_rbs" filtroOperador="=" filtroValor="%AsignaFolioRBS.AsignaFolioRBS.folio_duep%"/>-->
                </tabla>
                <nivel id="GrabaDuepBSD1" nombre="GrabaDuepBSD1" interactivo="false">
                    <componente tipo="altaDirect" id="GrabaDuepBSD1" nombre="GrabaDuepBSD1">                
                        <tabla schema="operation" nombre="duep_detalle">
                              <campo name="ur" text="Unidad Responsable" llaveForanea="false" calc="%GrabaDuepBSD.GrabaDuepBSD.ur%"/>
                              <campo name="periodo" text="Periodo" llaveForanea="false" calc="%GrabaDuepBSD.GrabaDuepBSD.periodo%"/>
                              <campo name="folio_duep" text="Folio" calc="@consultaDirec('SELECT MAX(folio_duep)  AS resultado FROM operation.duep
                              WHERE ur='+$config.ur$+' AND periodo='+$inParam.periodo$+' AND folio_origen='+%GrabaDuepBS.GrabaDuepBS.folio_rbs%,'resultado','int','MAGNITUS')"/>
                              <campo name="folio_duep_detalle" text="Renglón" generacion="@prox()+1" autogenerado="true"/>
                              <campo name="tipo_detalle" text="Tipo Renglón" calc="1"/>
                              <campo name="proveedor" text="Proveedor"/>
                              <campo name="articulo" text="Artículo" calc="%GrabaDuepBSD.GrabaDuepBSD.clave_articulo%"/> 
                              <campo name="id_cat_objeto_gasto" text="COG" llaveForanea="false"  calc="%GrabaDuepBSD.GrabaDuepBSD.id_cat_cog%"/>
                              <campo name="c_objeto_gasto" text="Objeto del Gasto" calc="%GrabaDuepBSD.GrabaDuepBSD.clasificador_objeto_gasto%"/>
                              <campo name="clave_presupuestal" text="clave presupuestal" calc="%GrabaDuepBSD.GrabaDuepBSD.clave_presup%"/>
                              <campo name="descripcion_especifica" text="Descripción Específica" calc="@consultaDirec('SELECT descripcion_especifica AS result FROM operation.requisicion_detalle WHERE ur= '+$inParam.ur$+' AND periodo='+$inParam.periodo$+' AND folio_req='+%GrabaDuepBS.GrabaDuepBS.folio_req%,'result','string','MAGNITUS')"/>
                              <campo name="id_cat_programa_presupuestal" text="Programa Presupuestal" calc="10" llaveForanea="false"/>
                              <campo name="programa_presupuestal" text="Programa Presupuestal" calc="%GrabaDuepBSD.GrabaDuepBSD.programa_presupuestal%"/>
                              <campo name="indicador" text="Indicador" 
                              calcCliente="@consultaDirec('SELECT idp.descripcion as descripcion FROM catalog.catalogos cat 
                              INNER JOIN catalog.programa_presupuestario pp ON cat.id_cat = pp.id_cat
                              INNER JOIN catalog.ficha_indicador fi ON pp.id_cat = fi.id_cat
                              INNER JOIN catalog.indicador_tipo idp ON idp.id_tipo = fi.tipo
                              WHERE cat.id_cat='+'\\''+%programa_presupuestal%+'\\''+' AND cat.id_catalogo = 10','descripcion','string','MAGNITUS')" habilitado="false" columna-visible="false" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-izquierdo="2"/>
                              <campo name="folio_comprobante" text="Folio Comprobante"/>
                              <campo name="tipo_comprobante" text="Tipo de Comprobante"/>
                              <campo name="cantidad" text="Cantidad" calc="%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%"/>
                              <campo name="u_medida" text="U.M." calc="%GrabaDuepBSD.GrabaDuepBSD.unidad_medida%"/>
                              <campo name="unidad_medida" text="U.M." calc="%GrabaDuepBSD.GrabaDuepBSD.unidad_medida%"/>
                              <campo name="precio_unitario" text="Importe Unitario" calc="%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%"/>
                              <campo name="descuento" text="Descuento"/>
                              <campo name="iva" text="Impuesto al Valor Agregado" calc="%GrabaDuepBSD.GrabaDuepBSD.tasa_iva%*%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%"/>
                              <campo name="otros_impuestos" text="Otros Impuestos"/>
                              <campo name="importe" text="Importe" calc="(%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%)"/>
                              <campo name="total" text="Total" calc="(%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%)+(%GrabaDuepBSD.GrabaDuepBSD.tasa_iva%*%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%)"/>
                              <campo name="fecha_registro" text="Fecha Registro" calc="@fechaSistema()"/>
                              <campo name="id_duep_contrato_pedido" text="Contrato" calc="%GrabaDuepBSD.GrabaDuepBSD.id_duep_contrato_pedido%"/>
                              <campo name="id_duep_contrato_pedido_det" text="Contrato" calc="%GrabaDuepBSD.GrabaDuepBSD.id_duep_contrato_pedido_det%"/>
                              <campo name="agrupador" text="agrupador" calc="%GrabaDuepBSD.GrabaDuepBSD.id_duep_contrato_pedido_det%"/>

                              <campi name="anticipo" text="anticipo" calc="%GrabaDuepBSD.GrabaDuepBSD.anticipo%"/> 
                      </tabla>
                    </componente>
                </nivel>
                <!-- <nivel id="dda" nombre="dda" interactivo="false">-->
                <!--    <componente tipo="cursor" id="dda" nombre="dda">        -->
                <!--            <tabla schema="operation" nombre="duep_detalle">-->
                <!--                <campo name="ur" text="Unidad Responsable" llaveForanea="false" filtroCampo="ur" filtroOperador="=" filtroValor="%GrabaDuepBSD.GrabaDuepBSD.ur%"/>-->
                <!--              <campo name="periodo" text="Periodo" llaveForanea="false" filtroCampo="periodo" filtroOperador="=" filtroValor="%GrabaDuepBSD.GrabaDuepBSD.periodo%"/>-->
                <!--                <campo name="folio_duep_detalle" text="Contrato Pedido" filtroCampo="folio_duep_detalle" filtroOperador="=" filtroValor="%GrabaDuepBSD1.GrabaDuepBSD1.folio_duep_detalle%"/>-->
                <!--                <campo name="agrupador" text="agrupador" calc="%GrabaDuepBSD.GrabaDuepBSD.id_duep_contrato_pedido_det%"/>-->
                <!--            </tabla>-->
                <!--    </componente>-->
                <!--</nivel>-->
                <nivel id="GrabaDuepBSD13" nombre="GrabaDuepBSD13" interactivo="false" ejecutar="%GrabaDuepBS.GrabaDuepBS.requiere_anticipo%==true">
                    <componente tipo="altaDirect" id="GrabaDuepBSD13" nombre="GrabaDuepBSD13">                
                        <tabla schema="operation" nombre="duep_detalle">
                              <campo name="ur" text="Unidad Responsable" llaveForanea="false" calc="%GrabaDuepBSD.GrabaDuepBSD.ur%"/>
                              <campo name="periodo" text="Periodo" llaveForanea="false" calc="%GrabaDuepBSD.GrabaDuepBSD.periodo%"/>
                              <campo name="folio_duep" text="Folio" calc="@consultaDirec('SELECT MAX(folio_duep)  AS resultado FROM operation.duep
                              WHERE ur='+$config.ur$+' AND periodo='+$inParam.periodo$+' AND folio_origen='+%GrabaDuepBS.GrabaDuepBS.folio_rbs%,'resultado','int','MAGNITUS')"/>
                              <campo name="folio_duep_detalle" text="Renglon" generacion="@prox()+1" autogenerado="true"/>
                              <campo name="tipo_detalle" text="Tipo Renglon" calc="1"/>
                              <campo name="proveedor" text="Proveedor"/>
                              <campo name="articulo" text="Artículo" calc="%GrabaDuepBSD.GrabaDuepBSD.clave_articulo%"/> 
                              <campo name="id_cat_objeto_gasto" text="COG" llaveForanea="false"  calc="%GrabaDuepBSD.GrabaDuepBSD.id_cat_cog%"/>
                              <campo name="c_objeto_gasto" text="Objeto del Gasto" calc="%GrabaDuepBSD.GrabaDuepBSD.clasificador_objeto_gasto%"/>
                              <campo name="clave_presupuestal" text="clave presupuestal" llaveForanea="false" calc="%GrabaDuepBSD.GrabaDuepBSD.clave_presup%"/>
                              <campo name="descripcion_especifica" text="Descripción Específica" calc="@consultaDirec('SELECT descripcion_especifica AS result FROM operation.requisicion_detalle WHERE ur= '+$inParam.ur$+' AND periodo='+$inParam.periodo$+' AND folio_req='+%GrabaDuepBS.GrabaDuepBS.folio_req%,'result','string','MAGNITUS')"/>
                              <campo name="id_cat_programa_presupuestal" text="Programa Presupuestal" calc="10" llaveForanea="false"/>
                              <campo name="programa_presupuestal" text="Programa Presupuestal" calc="%GrabaDuepBSD.GrabaDuepBSD.programa_presupuestal%"/>
                              <campo name="indicador" text="Indicador" 
                              calcCliente="@consultaDirec('SELECT idp.descripcion as descripcion FROM catalog.catalogos cat 
                              INNER JOIN catalog.programa_presupuestario pp ON cat.id_cat = pp.id_cat
                              INNER JOIN catalog.ficha_indicador fi ON pp.id_cat = fi.id_cat
                              INNER JOIN catalog.indicador_tipo idp ON idp.id_tipo = fi.tipo
                              WHERE cat.id_cat='+'\\''+%programa_presupuestal%+'\\''+' AND cat.id_catalogo = 10','descripcion','string','MAGNITUS')" habilitado="false" columna-visible="false" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-izquierdo="2"/>
                              <campo name="folio_comprobante" text="Folio Comprobante"/>
                              <campo name="tipo_comprobante" text="Tipo de Comprobante"/>
                              <campo name="cantidad" text="Cantidad" calc="@castTo(%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%,'long')"/>
                              <campo name="u_medida" text="U.M." calc="%GrabaDuepBSD.GrabaDuepBSD.unidad_medida%"/>
                              <campo name="unidad_medida" text="U.M." calc="%GrabaDuepBSD.GrabaDuepBSD.unidad_medida%"/>
                              <campo name="precio_unitario" text="Importe Unitario" calc="%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%"/>
                              <campo name="descuento" text="Descuento"/>
                              <campo name="iva" text="Impuesto al Valor Agregado" calc="%GrabaDuepBSD.GrabaDuepBSD.tasa_iva%*%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%"/>
                              <campo name="otros_impuestos" text="Otros Impuestos"/>
                              <campo name="importe" text="Importe" calc="(%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%)"/>
                              <!--0-((%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%)*(%GrabaDuepBS.GrabaDuepBS.anticipo%/100))
                              
                              calc="0-(((%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%)+(%GrabaDuepBSD.GrabaDuepBSD.tasa_iva%*%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%))*(%GrabaDuepBS.GrabaDuepBS.anticipo%/100))"-->
                              <campo name="total" text="Total" calc="0-(((%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%)+(%GrabaDuepBSD.GrabaDuepBSD.tasa_iva%*%GrabaDuepBSD.GrabaDuepBSD.cantidad_recibida_rbs%*%GrabaDuepBSD.GrabaDuepBSD.precio_unitario%))-(%GrabaDuepBS.GrabaDuepBS.anticipo%/100))"/>
                              <campo name="fecha_registro" text="Fecha Registro" calc="@fechaSistema()"/>
                              <campo name="id_duep_contrato_pedido" text="Contrato" calc="%GrabaDuepBSD.GrabaDuepBSD.id_duep_contrato_pedido%"/>
                              <campo name="id_duep_contrato_pedido_det" text="Contrato" calc="%GrabaDuepBSD.GrabaDuepBSD.id_duep_contrato_pedido_det%"/>
                             <campo name="agrupador" text="agrupador" calc="%GrabaDuepBSD.GrabaDuepBSD.id_duep_contrato_pedido_det%"/>
                      </tabla>
                    </componente>
                </nivel>
                <nivel id="GrabaDuepBSD11" nombre="GrabaDuepBSD11" interactivo="false">
                    <componente tipo="cursor" id="GrabaDuepBSD11" nombre="GrabaDuepBSD11">        
                            <tabla schema="operation" nombre="duep_contrato_pedido_det">
                                <campo name="ur" text="Unidad Responsable" filtroCampo="ur" filtroOperador="=" filtroValor="$inParam.ur$" llaveForanea="false"/>
                                <campo name="periodo" text="Periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="$inParam.periodo$" llaveForanea="false"/>
                                <campo name="id_duep_contrato_pedido" text="Contrato Pedido" filtroCampo="id_duep_contrato_pedido" filtroOperador="=" filtroValor="$inParam.contrato$"/>
                                <campo name="estatus_seleccion" calc="true"/>
                            </tabla>
                    </componente>
                </nivel>
            </componente>
        </nivel>
        
        <nivel id="nlRecepcionBS" nombre="Recepción de Bienes o Servicios" mostrarProximoNivel="false" mostrarNivelAnterior="false">
            <componente id="cpRecepcionBS" nombre="Recepción Bienes o Servicios" tipo="maestroDetalle" colapsado="NO">
                <encabezado accionDefault="editar">
                    <tabla id="tablaEncabezadoDUEP" schema="operation" nombre="duep">
                        <campo name="ur" text="Unidad Responsable" visible="false" llaveForanea="false" calc="$inParam.ur$"/>
                        <campo name="periodo" text="Periodo" visible="false" calc="$inParam.periodo$" llaveForanea="false"/> 
                        <campo name="folio_duep" text="Folio"  calc="$inParam.duep$" columnas="3" margen-izquierdo="2" visible="false"/>
                        <campo name="folio_duep_a" text="Folio"  columnas="3" margen-izquierdo="2" habilitado="false"/>
                        <campo name="tramite" text="Trámite" habilitado="false" marcador="Trámite" descripcionForanea="siglas,nombre" calc="8" columnas="3" margen-derecho="2"/>
                        <campo name="beneficiario" text="Beneficiario" habilitado="false" llavesFijas="id_estatus_beneficiario=1" descripcionForanea="folio_beneficiario, razon_social" marcador="Seleccionar un Beneficiario" validacion="%beneficiario%==null" validacionMensaje="Favor de seleccionar un Beneficiario" columnas="3" margen-izquierdo="2"/>
                        <campo name="id_cat_fondo_contable" text="Categoría de Fondo Contable" calc="3" llaveForanea="false" visible="false"/>
                        <campo name="id_fondo_contable" text="Fondo Contable" habilitado="false" marcador="Seleccione un Fondo Contable"  columnas="3"  margen-derecho="2"/>
                        <campo name="id_cat_unidad_ejecutora_gasto" text="Categoría Unidad Ejecutora" visible="false" calc="2" llaveForanea="false"/>
                        <campo name="id_unidad_ejecutora_gasto" habilitado="false" text="Centro de Registro" marcador="Selecciona un Centro de Registro" visible="true" columnas="3" margen-izquierdo="2"/>
                        <campo name="id_fuente_financiamiento" text="ID Fuente de Financiamiento" llaveForanea="false" visible="false"/>
                        <campo name="id_cat_fuente_financiamiento" text="Fuente de Financiamiento" habilitado="false" visible="true" columnas="3" margen-derecho="2"/>
                        <campo name="fecha_solicitud" text="Fecha" calc="@fechaSistema()" habilitado="%barreUsuarios.barreUsuarios.permisos_especiales%==true" columnas="3" margen-izquierdo="2"/>
                        <campo name="id_contrato" text="Contrato" habilitado="false" visible="true" descripcionForanea="folio_con_ordecom" columnas="3" margen-derecho="2"/>
                        <campo name="tipo_comprobante" text="Tipo de Comprobante" visible="true" habilitado="true" descripcionForanea="descripcion" validacion="%tipo_comprobante%==null" validacionMensaje="Debe de Capturar el Tipo de Comprobante" columnas="3" margen-izquierdo="2"/>
                        <campo name="folio_comprobante" text="Folio de Comprobante" visible="true" habilitado="true" validacion="%folio_comprobante%==null" validacionMensaje="Debe de Capturar el Folio de Comprobante" columnas="3" margen-derecho="2"/>
                        <campo name="fecha_autorizacion" text="Fecha de Autorización" habilitado="false" marcador="Fecha de Autorización" visible="false" columnas="3" margen-izquierdo="2"/>
                        <campo name="concepto" text="Concepto" height="100" marcador="Ingresa un Concepto" columnas="6" margen-izquierdo="2"/>
                        <campo name="total" text="Total" visible="false"/>
                        <campo name="ultimo_usuario_modificador" calc="%barreUsuarios.barreUsuarios.id_usuario%" visible="false"/>
                        <campo name="estatus_duep" text="Estatus" calc="1" visible="false" llaveForanea="false"/>
                    </tabla>
                    <estilos>
                        <boton nombre="grabar" visible="true" texto="Grabar" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                    </estilos>
                </encabezado>
                <detalles>
                    <tabla id="detalle_bloques" schema="operation" nombre="duep_detalle" tituloDetalle="Renglones" mostrarEditar="true" mostrarEliminar="false">
                        <campo name="ur" text="Unidad Responsable" llaveForanea="false" visible="false" columna-visible="false"/>
                        <campo name="periodo" text="Periodo" llaveForanea="false" visible="false" columna-visible="false"/>
                        <campo name="folio_duep" text="Folio" llaveForanea="false" visible="false" columna-visible="false"/>
                        <campo name="folio_duep_detalle" text="Renglón" generacion="@prox()+1" autogenerado="true" width="100" columnas="3" margen-izquierdo="2" columna-visible="false" visible="false"/>
                        <campo name="agrupador" text="Renglón" width="100" columnas="3" margen-izquierdo="2" calc="(@consultaDirec('SELECT (agrupador) AS resultado
                                FROM operation.duep_detalle
                                WHERE ur='+$config.ur$+' AND folio_duep='+$inParam.duep$+' AND  periodo='+$inParam.periodo$,'resultado','int','MAGNITUS')+1)"/>
                        <campo name="tipo_detalle" text="Tipo Renglón" validacion="%tipo_detalle%==null or (%tipo_detalle%==1 and %folio_duep_detalle%==null)" llavesFijas="id_detalle_duep=1 OR id_detalle_duep=2" validacionMensaje="no puede de Capturar el Tipo Renglón presupuestal" width="100" columnas="3" margen-derecho="2" habilitado="%tipo_detalle%!=1"/>
                        <campo name="proveedor" text="Proveedor" marcador="Seleccione un proveedor" descripcionForanea="razon_social" descripcionForaneaTabla="nombre, primer_apellido, segundo_apellido" columna-visible="false" columnas="3" margen-izquierdo="2"/>
                        <campo name="articulo" text="Artículo" habilitado="true" descripcionForanea="descripcion_articulo" descripcionForaneaTabla="descripcion_articulo" marcador="Seleccione un artículo" width="100" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-derecho="2"/> 
                        <campo name="id_cat_objeto_gasto" text="Cat Objeto del Gasto" visible="false" calc="4" columna-visible="false" llaveForanea="false"/>
                        <campo name="c_objeto_gasto" text="Objeto del Gasto" visible="true" width="150" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-izquierdo="2"/>
                        <campo name="clave_presupuestal" text="clave presupuestal" columna-visible="false" habilitado="false" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-derecho="2"/>
                        <campo name="folio_req" text="Folio" columna-visible="true" local="true" type="long" calc="%GrabaDuepBS.GrabaDuepBS.folio_req%" visible="false"/>
                        <campo name="descripcion_especifica" text="Descripción Específica" columna-visible="false" interaccion-visible="%tipo_detalle%==1 OR %tipo_detalle%==2" columnas="3" margen-izquierdo="2" calc="@consultaDirec('SELECT descripcion_especifica AS result FROM operation.requisicion_detalle WHERE ur= '+$inParam.ur$+' AND periodo='+$inParam.periodo$+' AND folio_req='+%folio_req%,'result','string','MAGNITUS')"/>
                        
                        <!---->
                        <campo name="id_cat_programa_presupuestal" text="Programa Presupuestal" calc="10" llaveForanea="false" visible="false" columna-visible="false"/>
                        <campo name="programa_presupuestal" text="Programa Presupuestal" marcador="Seleccione un programa presupuestal" width="150" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-derecho="2"/>
                        <campo name="indicador" text="Indicador" 
                        calcCliente="@consultaDirec('SELECT idp.descripcion as descripcion FROM catalog.catalogos cat 
                            INNER JOIN catalog.programa_presupuestario pp ON cat.id_cat = pp.id_cat
                            INNER JOIN catalog.ficha_indicador fi ON pp.id_cat = fi.id_cat
                            INNER JOIN catalog.indicador_tipo idp ON idp.id_tipo = fi.tipo
                                WHERE cat.id_cat='+'\\''+%programa_presupuestal%+'\\''+' AND cat.id_catalogo = 10','descripcion','string','MAGNITUS')" habilitado="false" columna-visible="false" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-izquierdo="2"/>
                        <campo name="folio_comprobante" text="Folio Comprobante" columna-visible="false" habilitado="false" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-derecho="2"/>
                        <campo name="tipo_comprobante" text="Tipo de Comprobante" columna-visible="false" interaccion-visible="%tipo_detalle%==2 OR %tipo_detalle%==1" habilitado="false" columnas="3"/> <!-- margen-derecho="3" -->
                        <campo name="u_medida" text="U.M." validacion="%tipo_detalle%==1 AND %u_medida%==null" validacionMensaje="Capture la Unidad de Medida" width="100" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-izquierdo="2" habilitado="false"/>
                        <campo name="cantidad" text="Cantidad" validacion="%tipo_detalle%==1 AND %cantidad%==null" validacionMensaje="Favor de Capturar la Cantidad" width="100" columnas="3" interaccion-visible="%tipo_detalle%==1" calcCliente="@ifThenElse(%tipo_detalle%==2,1,%cantidad%)"/>
                        <campo name="precio_unitario" text="Importe Unitario" validacion="%tipo_detalle%==1 AND %precio_unitario%==null" validacionMensaje="Debe de Capturar el Precio Unitario" width="100" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-izquierdo="2" habilitado="false"/> <!-- margen-izquierdo="2"-->
                        <campo name="descuento" text="Descuento" columna-visible="false" width="100" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-derecho="2" habilitado="false"/>
                         <campo name="importe" text="Importe" columna-visible="false" visible="false"/>
                        <campo name="iva" text="Impuesto al Valor Agregado" muestraAcumulado="true" habilitado="false" calcCliente="((%precio_unitario%-%descuento%)*0.16)" width="100" columna-visible="false" interaccion-visible="%tipo_detalle%==1" columnas="3" margen-izquierdo="2"/>
                        <campo name="otros_impuestos" text="Otros Impuestos" muestraAcumulado="true" width="100" columna-visible="false" interaccion-visible="%tipo_detalle%==1" columnas="3" habilitado="false"/>
                        <!--<campo name="adjunta_archivo" text="Adjunta Soporte Documental" local="true" type="file" columna-visible="false"/>-->
                        <campo name="total" text="Importe Total" muestraAcumulado="true" calcCliente="@ifThenElse(%tipo_detalle%==2,((-1)*(%importe%)),(%cantidad%*(%precio_unitario%-%descuento%)))" interaccion-visible="%tipo_detalle%==1 OR %tipo_detalle%==2" width="100" interaccion="%tipo_detalle%==2" columnas="3" margen-izquierdo="2"/> <!-- -->
                        <campo name="fecha_registro" text="Fecha Registro" calc="@fechaSistema()" habilitado="false" visible="false" columna-visible="false"/>
                      </tabla>
                      <acciones>
                        <accion nombre="grabar" hacer="saltar siguiente nivel"/>
                      </acciones>
                      <!--<estilos>
                          <boton nombre="grabar" visible="true" texto="Grabar" columnas="2" margen-izquierdo="4" margen-derecho="4"/>
                      </estilos>-->
                </detalles>
            </componente>
        </nivel>
        <nivel id="BarreTotal" nombre="BarreTotal" interactivo="false">
            <componente tipo="cursor" id="BarreTotal" nombre="BarreTotal">        
                <tabla schema="operation" nombre="duep">
                  <campo name="ur" text="Unidad Responsable" llaveForanea="false" filtroCampo="ur" filtroOperador="=" filtroValor="$inParam.ur$"/>
                  <campo name="periodo" text="Periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="$inParam.periodo$" llaveForanea="false"/> 
                  <campo name="folio_duep" text="Folio" filtroCampo="folio_duep" filtroOperador="=" filtroValor="$inParam.duep$"/>
                  <campo name="tipo_comprobante" text="TC"/>
                  <campo name="folio_comprobante" text="FC"/>
                </tabla>
                <nivel id="GrabaTotal" nombre="GrabaTotal" interactivo="false">
                     <componente tipo="cursor" id="GrabaTotal" nombre="GrabaTotal">        
                       <tabla schema="operation" nombre="duep_detalle">
                        <campo name="ur" text="Unidad Responsable" llaveForanea="false" filtroCampo="ur" filtroOperador="=" filtroValor="%BarreTotal.BarreTotal.ur%"/>
                        <campo name="periodo" text="Periodo" filtroCampo="periodo" filtroOperador="=" filtroValor="%BarreTotal.BarreTotal.periodo%" llaveForanea="false"/> 
                        <campo name="folio_duep" text="Folio" filtroCampo="folio_duep" filtroOperador="=" filtroValor="%BarreTotal.BarreTotal.folio_duep%"/>
                        <campo name="folio_duep_detalle"/>
                        <campo name="tipo_comprobante" text="TC" calc="%BarreTotal.BarreTotal.tipo_comprobante%"/>
                        <campo name="folio_comprobante" text="FC" calc="%BarreTotal.BarreTotal.folio_comprobante%"/>
                       </tabla>
                     </componente>
                </nivel>
            </componente>
        </nivel>
        <nivel id="reporteRBS" nombre="Reporte Recepción de Bienes o Servicios" mostrarProximoNivel="false" mostrarNivelAnterior="false">
            <componente id="reporteSEDS" nombre="Reporte Recepción de Bienes" tipo="reporte" >
                <reporte nombre="Rbs" expediente="Expediente Adquisiciones/Recepcion de Materiales o Servicios" nombreDocumento="'Reporte de Recepción'" 
                         grupo="$inParam.adquisicion$" url="$config.repository_upload_file$" update="false"> 
                    <campo name="id_unidad_responsable" text="ur" type="long" calc="$inParam.ur$"/>
                    <campo name="id_periodo" type="long" calc="$inParam.periodo$"/>
                    <campo name="nombre_usuario" text="Usuario" local="true" type="string" calc="$protocolarios.user$"/>
                    <campo name="folio_duep" type="long" calc="$inParam.duep$"/>
                </reporte>
            </componente>
            <!--<componente id="reporteSEDSD" nombre="Reporte Estado de Cuenta Detallado del DUEP" tipo="reporte" colapsado="NO">
                <reporte nombre="Edo_cta_duep"> 
                    <campo name="id_unidad_responsable" text="ur" type="long" calc="$inParam.ur$"/>
                    <campo name="id_periodo" type="long" calc="$inParam.periodo$"/>
                    <campo name="nombre_usuario" text="Usuario" local="true" type="string" calc="$protocolarios.user$"/>
                    <campo name="folio_duep" type="long" calc="$inParam.duep$"/>
                    <campo name="id_contrato" type="long" calc="%nlRecepcionBS.cpRecepcionBS.tablaEncabezadoDUEP.id_contrato%"/>
                </reporte>
            </componente>-->
        </nivel>
    </pagina>
</tarea>